(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[1023],{1023:(ki,Bt,ut)=>{ut.r(Bt),ut.d(Bt,{$$addStore:()=>Z,$$deleteStore:()=>lt,$$updateStore:()=>It,AkitaPlugin:()=>rt,DEFAULT_ID_KEY:()=>L,DirtyCheckPlugin:()=>Ie,EntityActions:()=>H,EntityCollectionPlugin:()=>Vt,EntityDirtyCheckPlugin:()=>fi,EntityService:()=>Oe,EntityStateHistoryPlugin:()=>mi,EntityStore:()=>K,EntityStoreAction:()=>N,EntityUIQuery:()=>ve,EntityUIStore:()=>kt,Order:()=>dt,Paginator:()=>pi,PaginatorPlugin:()=>$t,PersistNgFormPlugin:()=>yi,Query:()=>xt,QueryConfig:()=>Ze,QueryEntity:()=>mt,SnapshotManager:()=>Ue,StateHistoryPlugin:()=>we,Store:()=>Ut,StoreAction:()=>Dt,StoreConfig:()=>We,__DEV__:()=>gt,__stores__:()=>v,action:()=>Kt,addEntities:()=>Rt,akitaConfig:()=>He,akitaDevtools:()=>Re,applyTransaction:()=>tt,arrayAdd:()=>Ot,arrayFind:()=>Fe,arrayRemove:()=>$e,arrayToggle:()=>je,arrayUpdate:()=>zt,arrayUpsert:()=>Ne,byId:()=>De,byKey:()=>qt,cacheable:()=>Be,coerceArray:()=>b,combineQueries:()=>Me,commit:()=>pe,compareValues:()=>te,configKey:()=>W,createEntityQuery:()=>ri,createEntityStore:()=>ni,createQuery:()=>si,createStore:()=>ii,currentAction:()=>O,dirtyCheckDefaultParams:()=>Ft,dispatchAdded:()=>Jt,dispatchDeleted:()=>Wt,dispatchUpdate:()=>Xt,distinctUntilArrayItemChanged:()=>_t,enableAkitaProdMode:()=>Qe,endBatch:()=>ge,entitiesToArray:()=>ee,entitiesToMap:()=>ie,filterNil:()=>Ye,filterNilValue:()=>Se,find:()=>Qt,getActiveEntities:()=>se,getAkitaConfig:()=>ct,getEntityStore:()=>Ce,getEntityStoreByName:()=>Te,getExitingActives:()=>Lt,getInitialEntitiesState:()=>ne,getNestedPath:()=>at,getStore:()=>jt,getStoreByName:()=>St,getValue:()=>it,guid:()=>ai,hasActiveState:()=>vt,hasEntity:()=>Q,isArray:()=>_,isDefined:()=>q,isDev:()=>P,isEmpty:()=>V,isEntityState:()=>ue,isFunction:()=>l,isMultiActiveState:()=>Pt,isNil:()=>I,isNotBrowser:()=>wt,isNumber:()=>oi,isObject:()=>M,isPlainObject:()=>pt,isString:()=>et,isTransactionInProcess:()=>Ct,isUndefined:()=>x,logAction:()=>k,persistState:()=>li,queryConfigKey:()=>yt,removeAllEntities:()=>ae,removeEntities:()=>re,resetCustomAction:()=>Mt,resetStores:()=>Si,resolveActiveEntity:()=>At,runEntityStoreAction:()=>Pi,runStoreAction:()=>vi,selectPersistStateInit:()=>ui,setAction:()=>A,setEntities:()=>ce,setLoading:()=>Ai,setLoadingAndError:()=>_i,setSkipAction:()=>Ht,setValue:()=>st,snapshotManager:()=>Ii,sortByOptions:()=>Ee,startBatch:()=>de,toBoolean:()=>R,toEntitiesIds:()=>wi,toEntitiesObject:()=>oe,trackIdChanges:()=>Ci,transaction:()=>Tt,transactionManager:()=>j,updateEntities:()=>ye,withTransaction:()=>Xe});const O={type:null,entityIds:null,skip:!1,payload:null};let Et=!1;function Mt(){Et=!1}function k(s,t,e){A(s,t,e),Et=!0}function A(s,t,e){!1===Et&&(O.type=s,O.entityIds=t,O.payload=e)}function Ht(s=!0){O.skip=s}function Kt(s,t){return function(e,i,n){const r=n.value;return n.value=function(...a){return k(s,t),r.apply(this,a)},n}}function Q(s,t){return s.hasOwnProperty(t)}function _(s){return Array.isArray(s)}function vt(s){return s.hasOwnProperty("active")}function Pt(s){return _(s)}function At({active:s,ids:t,entities:e}){return Pt(s)?Lt(s,t):!1===Q(e,s)?null:s}function Lt(s,t){const e=s.filter(i=>t.indexOf(i)>-1);return e.length===s.length?s:e}function Rt({state:s,entities:t,idKey:e,options:i={},preAddEntity:n}){let r={},a=[],u=!1;for(const c of t)if(!1===Q(s.entities,c[e])){const h=n(c),g=h[e];r[g]=h,i.prepend?a.unshift(g):a.push(g),u=!0}return u?{newState:{...s,entities:{...s.entities,...r},ids:i.prepend?[...a,...s.ids]:[...s.ids,...a]},newIds:a}:null}function I(s){return null==s}function b(s){return I(s)?[]:Array.isArray(s)?s:[s]}function Ot(s,t,e={}){const i=b(t),n=s||[];return e.prepend?[...i,...n]:[...n,...i]}var o=ut(4866);const L="id";function V(s){return!!_(s)&&0===s.length}function l(s){return"function"==typeof s}function Qt(s,t,e){const i=[];if(l(t))for(const n of s)!0===t(n)&&i.push(n);else{const n=b(t).reduce((r,a)=>r.add(a),new Set);for(const r of s)n.has(r[e])&&i.push(r)}return i}function _t(){return(0,o.distinctUntilChanged)((s,t)=>s===t||!(!_(s)||!_(t))&&(!(!V(s)||!V(t))||s.length===t.length&&!1===t.some((i,n)=>s[n]!==i)))}function Fe(s,t){return function(e){return e.pipe((0,o.map)(i=>!1===_(i)?i:Qt(i,s,t||L)),_t(),(0,o.map)(i=>!1===_(i)||_(s)||l(s)?i:i[0]))}}function M(s){const t=typeof s;return null!=s&&("object"==t||"function"==t)}function $e(s,t,e=L){let i,n;if(l(t)?n=function Ve(s){return function(...t){return!s(...t)}}(t):(i=b(t),n=r=>!1===i.includes(M(r)?r[e]:r)),Array.isArray(s))return s.filter(n)}function qt(s){return(t,e)=>t[s]===e[s]}function De(){return qt("id")}function je(s,t,e=(i,n)=>i===n){const i=s.findIndex(n=>e(t,n));return~i?[...s.slice(0,i),...s.slice(i+1)]:[...s,t]}function zt(s,t,e,i=L){let n;if(l(t))n=t;else{const a=b(t);n=u=>!0===a.includes(M(u)?u[i]:u)}return s.map((u,c)=>!0===n(u,c)?M(u)?{...u,...e}:e:u)}function Ne(s,t,e,i=L){const n=M(e);return s.some(a=>n?a[i]===t:a===t)?zt(s,t,e,i):Ot(s,n?{...e,[i]:t}:e)}function Be(s,t,e={emitNext:!1}){return s._cache().value?e.emitNext?(0,o.of)(void 0):o.EMPTY:t}function Me(s){return(0,o.combineLatest)(s).pipe((0,o.auditTime)(0))}let ht={resettable:!1,ttl:null,producerFn:void 0};function He(s){ht={...ht,...s}}function ct(){return ht}function q(s){return!1===I(s)}const lt=new o.Subject,Z=new o.ReplaySubject(50,5e3),It=new o.Subject;function Wt(s){lt.next(s)}function Jt(s){Z.next(s)}function Xt(s,t){It.next({storeName:s,action:t})}const ft=typeof window<"u",wt=!ft,Yt=()=>{try{return typeof localStorage<"u"}catch{return!1}},Le=()=>{try{return typeof sessionStorage<"u"}catch{return!1}},v={},Gt={};function Zt(s){return s&&s.charAt(0).toUpperCase()+s.slice(1)}ft&&(window.$$stores=v,window.$$queries=Gt);let z=[];function Re(s,t={}){if(wt||!window.__REDUX_DEVTOOLS_EXTENSION__)return;z.length&&z.forEach(h=>{h.unsubscribe?h.unsubscribe():h&&h()}),s&&s.run||((s=s||{}).run=h=>h(),t=s);const n=Object.assign({},{name:"Akita",shallow:!0,storesWhitelist:[]},t),r=n.storesWhitelist,a=window.__REDUX_DEVTOOLS_EXTENSION__.connect(n);let u={};const c=h=>!r.length||r.indexOf(h)>-1;z.push(Z.subscribe(h=>{!1!==c(h)&&(u={...u,[h]:v[h]._value()},a.send({type:`[${Zt(h)}] - @@INIT`},u))})),z.push(lt.subscribe(h=>{!1!==c(h)&&(delete u[h],a.send({type:`[${h}] - Delete Store`},u))})),z.push(It.subscribe(({storeName:h,action:g})=>{if(!1===c(h))return;const{type:f,entityIds:p,skip:E,...m}=g,$=m.payload;if(E)return void Ht(!1);const U=v[h];if(!U||!1===t.shallow&&u[h]&&JSON.stringify(U._value())===JSON.stringify(u[h]))return;u={...u,[h]:U._value()};const D=Zt(h);let F=q(p)?`[${D}] - ${f} (ids: ${p})`:`[${D}] - ${f}`;if(t.logTrace&&(console.group(F),console.trace(),console.groupEnd()),t.sortAlphabetically){const ot=Object.keys(u).sort().reduce((J,X)=>(J[X]=u[X],J),{});a.send({type:F,...$},ot)}else a.send({type:F,...$},u)})),z.push(a.subscribe(h=>{if("DISPATCH"===h.type){if("COMMIT"===h.payload.type)return void a.init(u);if(h.state){const f=JSON.parse(h.state);for(let p=0,E=Object.keys(f);p<E.length;p++){const m=E[p];v[m]&&s.run(()=>{v[m]._setState(()=>f[m],!1)})}}}}))}var dt=function(s){return s.ASC="asc",s.DESC="desc",s}(dt||{});function te(s,t=dt.ASC){return function(e,i){if(!e.hasOwnProperty(s)||!i.hasOwnProperty(s))return 0;const n="string"==typeof e[s]?e[s].toUpperCase():e[s],r="string"==typeof i[s]?i[s].toUpperCase():i[s];let a=0;return n>r?a=1:n<r&&(a=-1),t==dt.DESC?-1*a:a}}function ee(s,t){let e=[];const{ids:i,entities:n}=s,{filterBy:r,limitTo:a,sortBy:u,sortByOrder:c}=t;for(let g=0;g<i.length;g++){const f=n[i[g]];r?b(r).every(m=>m(f,g))&&e.push(f):e.push(f)}if(u){let g=l(u)?u:te(u,c);e=e.sort((f,p)=>g(f,p,s))}const h=Math.min(a||e.length,e.length);return h===e.length?e:e.slice(0,h)}function ie(s,t){const e={},{filterBy:i,limitTo:n}=t,{ids:r,entities:a}=s;if(!i&&!n)return a;const u=!1===I(n);if(i&&u){let c=0;for(let h=0,g=r.length;h<g&&c!==n;h++){const f=r[h],p=a[f];b(i).every(m=>m(p,h))&&(e[f]=p,c++)}}else{const c=Math.min(n||r.length,r.length);for(let h=0;h<c;h++){const g=r[h],f=a[g];i?b(i).every(E=>E(f,h))&&(e[g]=f):e[g]=f}}return e}var H=function(s){return s.Set="Set",s.Add="Add",s.Update="Update",s.Remove="Remove",s}(H||{});class Oe{}var C=ut(1635);let gt=!0;function Qe(){gt=!1,ft&&(delete window.$$stores,delete window.$$queries)}function P(){return gt}function se(s,t,e){let i;if(_(s))i=s;else if(M(s)){if(I(e))return;s=Object.assign({wrap:!0},s);const n=t.indexOf(e);if(s.prev){const r=0===n;if(r&&!s.wrap)return;i=r?t[t.length-1]:t[n-1]}else if(s.next){const r=t.length===n+1;if(r&&!s.wrap)return;i=r?t[0]:t[n+1]}}else{if(s===e)return;i=s}return i}const ne=()=>({entities:{},ids:[],loading:!0,error:null});function x(s){return void 0===s}function re({state:s,ids:t}){if(I(t))return ae(s);const e=s.entities;let i={};for(const r of s.ids)!1===t.includes(r)&&(i[r]=e[r]);const n={...s,entities:i,ids:s.ids.filter(r=>!1===t.includes(r))};return vt(s)&&(n.active=At(n)),n}function ae(s){return{...s,entities:{},ids:[],active:Pt(s.active)?[]:null}}function oe(s,t,e){const i={entities:{},ids:[]};for(const n of s){const r=e(n);i.entities[r[t]]=r,i.ids.push(r[t])}return i}function ue(s){return s.entities&&s.ids}function he(s,t){let e={};for(const i of Object.keys(s))e[i]=t(s[i]);return e}function ce({state:s,entities:t,idKey:e,preAddEntity:i,isNativePreAdd:n}){let r,a;if(_(t)){const c=oe(t,e,i);r=c.entities,a=c.ids}else ue(t)?(r=n?t.entities:he(t.entities,i),a=t.ids):(r=n?t:he(t,i),a=Object.keys(r).map(c=>isNaN(c)?c:Number(c)));const u={...s,entities:r,ids:a,loading:!1};return vt(s)&&(u.active=At(u)),u}function le(s){Object.freeze(s);const t="function"==typeof s,e=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(s).forEach(function(i){e.call(s,i)&&(!t||"caller"!==i&&"callee"!==i&&"arguments"!==i)&&null!==s[i]&&("object"==typeof s[i]||"function"==typeof s[i])&&!Object.isFrozen(s[i])&&le(s[i])}),s}class qe extends Error{constructor(t){super(t)}}function R(s){return null!=s&&"false"!=`${s}`}function pt(s){return R(s)&&"Object"===s.constructor.name}const W="akitaConfig";function We(s){return function(t){t[W]={idKey:"id"};for(let e=0,i=Object.keys(s);e<i.length;e++){const n=i[e];"name"===n?t[W].storeName=s[n]:t[W][n]=s[n]}}}const Je=new o.Subject,fe=new o.BehaviorSubject(!1),j={activeTransactions:0,batchTransaction:null};function de(){Ct()||(j.batchTransaction=new o.Subject),j.activeTransactions++,fe.next(!0)}function ge(){0==--j.activeTransactions&&(j.batchTransaction.next(!0),j.batchTransaction.complete(),fe.next(!1),Je.next(!0))}function Ct(){return j.activeTransactions>0}function pe(){return j.batchTransaction?j.batchTransaction.asObservable():(0,o.of)(!0)}function tt(s,t=void 0){de();try{return s.apply(t)}finally{k("@Transaction"),ge()}}function Tt(){return function(s,t,e){const i=e.value;return e.value=function(...n){return tt(()=>i.apply(this,n),this)},e}}function Xe(s){return function(t){return t.pipe((0,o.tap)(e=>tt(()=>s(e))))}}class Ut{constructor(t,e={}){this.options=e,this.inTransaction=!1,this.cache={active:new o.BehaviorSubject(!1),ttl:null},this.onInit(t)}setLoading(t=!1){t!==this._value().loading&&(P()&&A("Set Loading"),this._setState(e=>({...e,loading:t})))}setHasCache(t,e={restartTTL:!1}){if(t!==this.cache.active.value&&this.cache.active.next(t),e.restartTTL){const i=this.getCacheTTL();i&&(null!==this.cache.ttl&&clearTimeout(this.cache.ttl),this.cache.ttl=setTimeout(()=>this.setHasCache(!1),i))}}getValue(){return this.storeValue}setError(t){t!==this._value().error&&(P()&&A("Set Error"),this._setState(e=>({...e,error:t})))}_select(t){return this.store.asObservable().pipe((0,o.map)(e=>t(e.state)),(0,o.distinctUntilChanged)())}_value(){return this.storeValue}_cache(){return this.cache.active}get config(){return this.constructor[W]||{}}get storeName(){return this.config.storeName||this.options.storeName||this.options.name}get deepFreeze(){return this.config.deepFreezeFn||this.options.deepFreezeFn||le}get cacheConfig(){return this.config.cache||this.options.cache}get _producerFn(){return this.config.producerFn||this.options.producerFn||function Ke(){return ht.producerFn}()}get resettable(){return q(this.config.resettable)?this.config.resettable:this.options.resettable}_setState(t,e=!0){if(l(t)){const i=t(this._value());this.storeValue=gt?this.deepFreeze(i):i}else this.storeValue=t;if(!this.store)return this.store=new o.BehaviorSubject({state:this.storeValue}),void(P()&&this.store.subscribe(({action:i})=>{i&&Xt(this.storeName,i)}));Ct()?this.handleTransaction():this.dispatch(this.storeValue,e)}reset(){this.isResettable()&&(P()&&A("Reset"),this._setState(()=>Object.assign({},this._initialState)),this.setHasCache(!1))}update(t){let e;P()&&A("Update");const i=this._value();e=l(t)?l(this._producerFn)?this._producerFn(i,t):t(i):t;const n=this.akitaPreUpdate(i,{...i,...e}),r=pt(i)?n:new i.constructor(n);this._setState(r)}updateStoreConfig(t){this.options={...this.options,...t}}akitaPreUpdate(t,e){return e}destroy(){(!ft||!window.hmrEnabled)&&this===v[this.storeName]&&(delete v[this.storeName],Wt(this.storeName),this.setHasCache(!1),this.cache.active.complete(),this.store.complete())}onInit(t){v[this.storeName]=this,this._setState(()=>t),Jt(this.storeName),this.isResettable()&&(this._initialState=t),P()&&function ze(s,t){s||console.error(`@StoreConfig({ name }) is missing in ${t}`)}(this.storeName,this.constructor.name)}dispatch(t,e=!0){let i;e&&(i=O,Mt()),this.store.next({state:t,action:i})}watchTransaction(){pe().subscribe(()=>{this.inTransaction=!1,this.dispatch(this._value())})}isResettable(){return!1!==this.resettable&&(this.resettable||ct().resettable)}handleTransaction(){this.inTransaction||(this.watchTransaction(),this.inTransaction=!0)}getCacheTTL(){return this.cacheConfig&&this.cacheConfig.ttl||ct().ttl}}function ye({state:s,ids:t,idKey:e,newStateOrFn:i,preUpdateEntity:n,producerFn:r,onEntityIdChanges:a}){const u={};let h,c=!1;for(const p of t){if(!1===Q(s.entities,p))continue;const E=s.entities[p];let m;m=l(i)?l(r)?r(E,i):i(E):i;const $=m.hasOwnProperty(e)&&m[e]!==E[e];let U;h=p,$&&(c=!0,h=m[e]);const D={...E,...m};U=pt(E)?D:pt(m)?new E.constructor(D):new m.constructor(D),u[h]=n(E,U)}let g=s.ids,f=s.entities;if(c){const[p]=t,{[p]:E,...m}=s.entities;f=m,g=s.ids.map($=>$===p?h:$),a(p,h)}return{...s,entities:{...f,...u},ids:g}}var me;class K extends Ut{constructor(t={},e={}){super({...ne(),...t},e),this.options=e,this.entityActions=new o.Subject,this.entityIdChanges=new o.Subject}get selectEntityAction$(){return this.entityActions.asObservable()}get selectEntityIdChanges$(){return this.entityIdChanges.asObservable()}get idKey(){return this.config.idKey||this.options.idKey||L}set(t,e={}){if(I(t))return;P()&&A("Set Entity");const i=this.akitaPreAddEntity===K.prototype.akitaPreAddEntity;this.setHasCache(!0,{restartTTL:!0}),this._setState(n=>{const r=ce({state:n,entities:t,idKey:this.idKey,preAddEntity:this.akitaPreAddEntity.bind(this),isNativePreAdd:i});return!1===x(e.activeId)&&(r.active=e.activeId),r}),this.hasInitialUIState()&&this.handleUICreation(),this.entityActions.next({type:H.Set,ids:this.ids})}add(t,e={loading:!1}){const i=b(t);if(V(i))return;const n=Rt({state:this._value(),preAddEntity:this.akitaPreAddEntity.bind(this),entities:i,idKey:this.idKey,options:e});n&&(P()&&A("Add Entity"),n.newState.loading=e.loading,this._setState(()=>n.newState),this.hasInitialUIState()&&this.handleUICreation(!0),this.entityActions.next({type:H.Add,ids:n.newIds}))}update(t,e){if(x(e))return void super.update(t);let n,i=[];i=l(t)?this.ids.filter(r=>t(this.entities[r])):I(t)?this.ids:b(t),V(i)||(P()&&A("Update Entity",i),this._setState(r=>ye({idKey:this.idKey,ids:i,preUpdateEntity:this.akitaPreUpdateEntity.bind(this),state:r,newStateOrFn:e,producerFn:this._producerFn,onEntityIdChanges:(a,u)=>{n={oldId:a,newId:u},this.entityIdChanges.next({...n,pending:!0})}})),n&&this.entityIdChanges.next({...n,pending:!1}),this.entityActions.next({type:H.Update,ids:i}))}upsert(t,e,i,n={}){const r=b(t),a=f=>p=>Q(this.entities,p)===f,u=l(i)?n.baseClass:i?i.baseClass:void 0,c=l(u),h=r.filter(a(!0)),g=r.filter(a(!1)).map(f=>{const p="function"==typeof e?e({}):e,m={...l(i)?i(f,p):p,[this.idKey]:f};return c?new u(m):m});this.update(h,e),this.add(g),P()&&k("Upsert Entity")}upsertMany(t,e={}){const i=[],n=[],r={};for(const a of t){const u=this.akitaPreCheckEntity(a),c=u[this.idKey];if(Q(this.entities,c)){const h=this._value().entities[c],g={...this._value().entities[c],...u},f=e.baseClass?new e.baseClass(g):g,p=this.akitaPreUpdateEntity(h,f),E=p[this.idKey];r[E]=p,n.push(E)}else{const h=e.baseClass?new e.baseClass(u):u,g=this.akitaPreAddEntity(h),f=g[this.idKey];i.push(f),r[f]=g}}P()&&k("Upsert Many"),this._setState(a=>({...a,ids:i.length?[...a.ids,...i]:a.ids,entities:{...a.entities,...r},loading:!!e.loading})),n.length&&this.entityActions.next({type:H.Update,ids:n}),i.length&&this.entityActions.next({type:H.Add,ids:i}),i.length&&this.hasUIStore()&&this.handleUICreation(!0)}replace(t,e){const i=b(t);if(V(i))return;const n={};for(const r of i)n[r]={...e,[this.idKey]:r};P()&&A("Replace Entity",t),this._setState(r=>({...r,entities:{...r.entities,...n}}))}move(t,e){const i=this.ids.slice();i.splice(e<0?i.length+e:e,0,i.splice(t,1)[0]),P()&&A("Move Entity"),this._setState(n=>({...n,entities:{...n.entities},ids:i}))}remove(t){if(V(this.ids))return;const e=q(t);let i=[];i=l(t)?this.ids.filter(n=>t(this.entities[n])):e?b(t):this.ids,!V(i)&&(P()&&A("Remove Entity",i),this._setState(n=>re({state:n,ids:i})),e||this.setHasCache(!1),this.handleUIRemove(i),this.entityActions.next({type:H.Remove,ids:i}))}updateActive(t){const e=b(this.active);P()&&A("Update Active",e),this.update(e,t)}setActive(t){const e=se(t,this.ids,this.active);void 0!==e&&(P()&&A("Set Active",e),this._setActive(e))}addActive(t){const e=b(t);V(e)||e.every(n=>this.active.indexOf(n)>-1)||(P()&&A("Add Active",t),this._setState(n=>{const r=Array.from(new Set([...n.active,...e]));return{...n,active:r}}))}removeActive(t){const e=b(t);V(e)||!e.some(n=>this.active.indexOf(n)>-1)||(P()&&A("Remove Active",t),this._setState(n=>({...n,active:Array.isArray(n.active)?n.active.filter(r=>-1===e.indexOf(r)):null})))}toggleActive(t){const e=b(t),i=a=>u=>this.active.includes(u)===a,n=e.filter(i(!0)),r=e.filter(i(!1));this.removeActive(n),this.addActive(r),P()&&k("Toggle Active")}createUIStore(t={},e={}){return this.ui=new kt(t,{name:`UI/${this.storeName}`,idKey:this.idKey,...e}),this.ui}destroy(){super.destroy(),this.ui instanceof K&&this.ui.destroy(),this.entityActions.complete()}akitaPreUpdateEntity(t,e){return e}akitaPreAddEntity(t){return t}akitaPreCheckEntity(t){return t}get ids(){return this._value().ids}get entities(){return this._value().entities}get active(){return this._value().active}_setActive(t){this._setState(e=>({...e,active:t}))}handleUICreation(t=!1){const e=this.ids,i=l(this.ui._akitaCreateEntityFn);let n;const r=a=>{const u=this.entities[a],c=i?this.ui._akitaCreateEntityFn(u):this.ui._akitaCreateEntityFn;return{[this.idKey]:u[this.idKey],...c}};n=t?this.ids.filter(a=>x(this.ui.entities[a])).map(r):e.map(r),t?this.ui.add(n):this.ui.set(n)}hasInitialUIState(){return this.hasUIStore()&&!1===x(this.ui._akitaCreateEntityFn)}handleUIRemove(t){this.hasUIStore()&&this.ui.remove(t)}hasUIStore(){return this.ui instanceof kt}}(0,C.Cg)([Tt(),(0,C.Sn)("design:type",Function),(0,C.Sn)("design:paramtypes",[Object,Object,Object,Object]),(0,C.Sn)("design:returntype",void 0)],K.prototype,"upsert",null),(0,C.Cg)([Tt(),(0,C.Sn)("design:type",Function),(0,C.Sn)("design:paramtypes",["function"==typeof(me=typeof T<"u"&&T)?me:Object]),(0,C.Sn)("design:returntype",void 0)],K.prototype,"toggleActive",null);class kt extends K{constructor(t={},e={}){super(t,e)}setInitialEntityState(t){this._akitaCreateEntityFn=t}}const Ye=s=>s.pipe((0,o.filter)(t=>null!==t&&typeof t<"u"));function Se(){return(0,o.filter)(s=>null!=s)}function et(s){return"string"==typeof s}const yt="akitaQueryConfig";function Ze(s){return function(t){t[yt]={};for(let e=0,i=Object.keys(s);e<i.length;e++){const n=i[e];t[yt][n]=s[n]}}}class xt{constructor(t){this.store=t,this.__store__=t,P()&&(Gt[t.storeName]=this)}select(t){let e;if(l(t))e=t;else if(et(t))e=i=>i[t];else{if(Array.isArray(t))return this.store._select(i=>i).pipe((0,o.distinctUntilChanged)(function Ge(s){return function(t,e){const i=l(s[0]);return!1===s.some(n=>i?n(t)!==n(e):t[n]!==e[n])}}(t)),(0,o.map)(i=>l(t[0])?t.map(n=>n(i)):t.reduce((n,r)=>(n[r]=i[r],n),{})));e=i=>i}return this.store._select(e)}selectLoading(){return this.select(t=>t.loading)}selectError(){return this.select(t=>t.error)}getValue(){return this.store._value()}selectHasCache(){return this.store._cache().asObservable()}getHasCache(){return this.store._cache().value}get config(){return this.constructor[yt]}}function be(s,t){return function(e){const i=e[s];if(!x(i))return t?et(t)?i[t]:t(i):i}}function Ee(s,t){s.sortBy=s.sortBy||t&&t.sortBy,s.sortByOrder=s.sortByOrder||t&&t.sortByOrder}class mt extends xt{constructor(t,e={}){super(t),this.options=e,this.__store__=t}selectAll(t={asObject:!1}){return this.select(e=>e.entities).pipe((0,o.map)(()=>this.getAll(t)))}getAll(t={asObject:!1,filterBy:void 0,limitTo:void 0}){return t.asObject?ie(this.getValue(),t):(Ee(t,this.config||this.options),ee(this.getValue(),t))}selectMany(t,e){return t&&t.length?this.select(i=>i.entities).pipe((0,o.map)(i=>function ei(s,t){return s.reduce((e,i,n,r)=>{const a=t(i,n,r);return void 0!==a&&e.push(a),e},[])}(t,n=>be(n,e)(i))),_t()):(0,o.of)([])}selectEntity(t,e){let i=t;return l(t)&&(i=function ti(s,t){for(const e of Object.keys(t))if(!0===s(t[e]))return e}(t,this.getValue().entities)),this.select(n=>n.entities).pipe((0,o.map)(be(i,e)),(0,o.distinctUntilChanged)())}getEntity(t){return this.getValue().entities[t]}selectActiveId(){return this.select(t=>t.active)}getActiveId(){return this.getValue().active}selectActive(t){return _(this.getActive())?this.selectActiveId().pipe((0,o.switchMap)(e=>this.selectMany(e,t))):this.selectActiveId().pipe((0,o.switchMap)(e=>this.selectEntity(e,t)))}getActive(){const t=this.getActiveId();return _(t)?t.map(e=>this.getValue().entities[e]):R(t)?this.getEntity(t):void 0}selectCount(t){return this.select(e=>e.entities).pipe((0,o.map)(()=>this.getCount(t)))}getCount(t){return l(t)?this.getAll().filter(t).length:this.getValue().ids.length}selectLast(t){return this.selectAt(e=>e[e.length-1],t)}selectFirst(t){return this.selectAt(e=>e[0],t)}selectEntityAction(t){if(I(t))return this.store.selectEntityAction$;const e=_(t)?n=>n:({ids:n})=>n,i=b(t);return this.store.selectEntityAction$.pipe((0,o.filter)(({type:n})=>i.includes(n)),(0,o.map)(n=>e(n)))}hasEntity(t){return I(t)?this.getValue().ids.length>0:l(t)?this.getAll().some(t):_(t)?t.every(e=>e in this.getValue().entities):t in this.getValue().entities}hasActive(t){const e=this.getValue().active,i=q(t);return Array.isArray(e)?i?e.includes(t):e.length>0:i?e===t:q(e)}createUIQuery(){this.ui=new ve(this.__store__.ui)}selectAt(t,e){return this.select(i=>i.ids).pipe((0,o.map)(t),(0,o.distinctUntilChanged)(),(0,o.switchMap)(i=>this.selectEntity(i,e)))}}class ve extends mt{constructor(t){super(t)}}function ii(s,t){return new Ut(s,t)}function si(s){return new xt(s)}function ni(s,t){return new K(s,t)}function ri(s,t={}){return new mt(s,t)}function it(s,t){return 1===t.split(".").length?s:t.split(".").slice(1).join(".").split(".").reduce((i,n)=>i&&i[n],s)}function ai(){return Math.random().toString(36).slice(2)}function oi(s){return!_(s)&&s-parseFloat(s)+1>=0}function st(s,t,e,i=!1){const n=t.split(".");if(1===n.length)return{...s,...e};s={...s};const r=n.length-2;return t.split(".").slice(1).reduce((u,c,h)=>h!==r?(u[c]={...u[c]},u&&u[c]):(u[c]=i||Array.isArray(u[c])||!M(u[c])?e:{...u[c],...e},u&&u[c]),s),s}let Pe=!1;const Ae=new o.ReplaySubject(1);function ui(){return Ae.asObservable()}function _e(s){Pe=s}function hi(){return Pe}function nt(s){return function ci(s){return s&&l(s.then)}(s)||(0,o.isObservable)(s)?(0,o.from)(s):(0,o.of)(s)}function li(s){const t={key:"AkitaStores",enableInNonBrowser:!1,storage:Yt()?localStorage:s.storage,deserialize:JSON.parse,serialize:JSON.stringify,include:[],select:[],persistOnDestroy:!1,preStorageUpdate:function(S,y){return y},preStoreUpdate:function(S,y){return y},skipStorageUpdate:hi,preStorageUpdateOperator:()=>S=>S},{storage:e,enableInNonBrowser:i,deserialize:n,serialize:r,include:a,select:u,key:c,preStorageUpdate:h,persistOnDestroy:g,preStorageUpdateOperator:f,preStoreUpdate:p,skipStorageUpdate:E}=Object.assign({},t,s);if(wt&&!i||!e)return;const m=a.length>0,$=u.length>0;let U,D;m&&(U=a.reduce((S,y)=>(l(y)?S.fns.push(y):S[y.split(".")[0]]=y,S),{fns:[]})),$&&(D=u.reduce((S,y)=>(S[y.storeName]=y,S),{}));let F={};const ot={},J=[],X=[];function ke(S){nt(S).subscribe(()=>{const y=X.shift();y&&ke(y)})}const Ui=Yt()&&e===localStorage||Le()&&e===sessionStorage;return nt(e.getItem(c)).subscribe(S=>{let y=M(S)?S:n(S||"{}");function B(d){y.$cache={...y.$cache||{},...d},y=Object.assign({},y,ot),X.push(e.setItem(c,Ui?r(y):y)),ke(X.shift())}function Y(d,G){F[d]=v[d]._select(w=>it(w,G)).pipe((0,o.skip)(1),(0,o.map)(w=>$&&D[d]?D[d](w):w),(0,o.filter)(()=>!1===E()),f()).subscribe(w=>{ot[d]=h(d,w),Promise.resolve().then(()=>B({[d]:v[d]._cache().getValue()}))})}function Nt(d,G,w){d in y&&(A("@PersistState"),G._setState(bt=>st(bt,w,p(d,y[d],bt))),v[d].setHasCache(!!y.$cache&&y.$cache[d],{restartTTL:!0}))}J.push(lt.subscribe(d=>{F[d]&&(!1===g&&B({[d]:!1}),F[d].unsubscribe(),delete F[d])})),J.push(Z.subscribe(d=>{if("router"===d)return;const G=v[d];if(m){let w=U[d];if(!w){if(!U.fns.some(bt=>bt(d)))return;w=d}Nt(d,G,w),Y(d,w)}else Nt(d,G,d),Y(d,d)})),Ae.next(!0)}),{destroy(){J.forEach(S=>S.unsubscribe());for(let S=0,y=Object.keys(F);S<y.length;S++)F[y[S]].unsubscribe();F={}},clear(){e.clear()},clearStore(S){I(S)?nt(e.setItem(c,"{}")).subscribe():nt(e.getItem(c)).subscribe(B=>{const Y=n(B||"{}");Y[S]&&(delete Y[S],nt(e.setItem(c,r(Y))).subscribe())})}}}class rt{constructor(t,e){this.query=t,e&&e.resetFn&&ct().resettable&&this.onReset(e.resetFn)}getQuery(){return this.query}getStore(){return this.getQuery().__store__}isEntityBased(t){return R(t)}selectSource(t,e){return this.isEntityBased(t)?this.getQuery().selectEntity(t).pipe(Se()):e?this.getQuery().select(i=>it(i,this.withStoreName(e))):this.getQuery().select()}getSource(t,e){if(this.isEntityBased(t))return this.getQuery().getEntity(t);const i=this.getQuery().getValue();return e?it(i,this.withStoreName(e)):i}withStoreName(t){return`${this.storeName}.${t}`}get storeName(){return this.getStore().storeName}updateStore(t,e,i,n=!1){if(this.isEntityBased(e)){const r=this.getStore();n?r.replace(e,t):r.update(e,t)}else{if(i)return void this.getStore()._setState(a=>st(a,this.withStoreName(i),t,!0));const r=n?t:a=>({...a,...t});this.getStore()._setState(r)}}onReset(t){const e=this.getStore().reset;this.getStore().reset=(...i)=>{setTimeout(()=>{e.apply(this.getStore(),i),t()})}}}const Ft={comparator:(s,t)=>JSON.stringify(s)!==JSON.stringify(t)};function at(s,t){return t.split(".").reduce((i,n)=>i&&"undefined"!==i[n]?i[n]:void 0,s)}class Ie extends rt{constructor(t,e,i){if(super(t),this.query=t,this.params=e,this._entityId=i,this.dirty=new o.BehaviorSubject(!1),this.active=!1,this._reset=new o.Subject,this.isDirty$=this.dirty.asObservable().pipe((0,o.distinctUntilChanged)()),this.reset$=this._reset.asObservable(),this.params={...Ft,...e},this.params.watchProperty){const n=b(this.params.watchProperty);t instanceof mt&&n.includes("entities")&&!n.includes("ids")&&n.push("ids"),this.params.watchProperty=n}}reset(t={}){let e=this.head;l(t.updateFn)&&(e=this.isEntityBased(this._entityId)?t.updateFn(this.head,this.getQuery().getEntity(this._entityId)):t.updateFn(this.head,this.getQuery().getValue())),k("@DirtyCheck - Revert"),this.updateStore(e,this._entityId),this._reset.next(!0)}setHead(){return this.active?this.head=this._getHead():(this.activate(),this.active=!0),this.updateDirtiness(!1),this}isDirty(){return!!this.dirty.value}hasHead(){return!!this.getHead()}destroy(){this.head=null,this.subscription&&this.subscription.unsubscribe(),this._reset&&this._reset.complete()}isPathDirty(t){const e=this.getHead(),n=at(this.getQuery().getValue(),t),r=at(e,t);return this.params.comparator(n,r)}getHead(){return this.head}activate(){this.head=this._getHead();const t=this.params.watchProperty?this.params.watchProperty.map(e=>this.query.select(i=>i[e]).pipe((0,o.map)(i=>({val:i,__akitaKey:e})))):[this.selectSource(this._entityId)];this.subscription=(0,o.combineLatest)(t).pipe((0,o.skip)(1)).subscribe(e=>{if(x(this.head))return;const i=e.some(n=>this.params.comparator(n.__akitaKey?this.head[n.__akitaKey]:this.head,n.__akitaKey?n.val:n));this.updateDirtiness(i)})}updateDirtiness(t){this.dirty.next(t)}_getHead(){let t=this.getSource(this._entityId);return this.params.watchProperty&&(t=this.getWatchedValues(t)),t}getWatchedValues(t){return this.params.watchProperty.reduce((e,i)=>(e[i]=t[i],e),{})}}class Vt{constructor(t,e){this.query=t,this.entityIds=e,this.entities=new Map}getEntity(t){return this.entities.get(t)}hasEntity(t){return this.entities.has(t)}removeEntity(t){return this.destroy(t),this.entities.delete(t)}createEntity(t,e){return this.entities.set(t,e)}getIds(){return x(this.entityIds)?this.query.getValue().ids:b(this.entityIds)}resolvedIds(t){return x(t)?this.getIds():b(t)}rebase(t,e={}){if(R(t))if(x(this.entityIds)){for(let i=0,n=t.length;i<n;i++){const r=t[i];if(!1===this.hasEntity(r)){l(e.beforeAdd)&&e.beforeAdd(r);const a=this.instantiatePlugin(r);this.entities.set(r,a),l(e.afterAdd)&&e.afterAdd(a)}}this.entities.forEach((i,n)=>{-1===t.indexOf(n)&&(l(e.beforeRemove)&&e.beforeRemove(i),this.removeEntity(n))})}else{const i=b(this.entityIds);for(let n=0,r=i.length;n<r;n++){const a=i[n];if(t.indexOf(a)>-1&&!1===this.hasEntity(a)){l(e.beforeAdd)&&e.beforeAdd(a);const u=this.instantiatePlugin(a);this.entities.set(a,u),l(e.afterAdd)&&e.afterAdd(u)}else this.entities.forEach((u,c)=>{-1===t.indexOf(c)&&!0===this.hasEntity(c)&&(l(e.beforeRemove)&&e.beforeRemove(u),this.removeEntity(c))})}}else this.getIds().forEach(i=>{this.hasEntity(i)||this.createEntity(i,this.instantiatePlugin(i))})}selectIds(){return this.query.select(t=>t.ids)}activate(t){this.rebase(t)}forEachId(t,e){const i=this.resolvedIds(t);for(let n=0,r=i.length;n<r;n++){const a=i[n];this.hasEntity(a)&&e(this.getEntity(a))}}}class fi extends Vt{constructor(t,e={}){super(t,e.entityIds),this.query=t,this.params=e,this._someDirty=new o.Subject,this.someDirty$=(0,o.merge)(this.query.select(i=>i.entities),this._someDirty.asObservable()).pipe((0,o.auditTime)(0),(0,o.map)(()=>this.checkSomeDirty())),this.params={...Ft,...e},this.activate(),this.selectIds().pipe((0,o.skip)(1)).subscribe(i=>{super.rebase(i,{afterAdd:n=>n.setHead()})})}setHead(t){if(this.params.entityIds&&t){const e=b(t);if(!1===b(this.params.entityIds).some(n=>e.indexOf(n)>-1))return this}return this.forEachId(t,e=>e.setHead()),this._someDirty.next(!0),this}hasHead(t){return!!this.entities.has(t)&&this.getEntity(t).hasHead()}reset(t,e={}){this.forEachId(t,i=>i.reset(e))}isDirty(t,e=!0){if(this.entities.has(t)){const i=this.getEntity(t);return e?i.isDirty$:i.isDirty()}return!1}someDirty(){return this.checkSomeDirty()}isPathDirty(t,e){if(this.entities.has(t)){const i=this.getEntity(t).getHead(),r=at(this.query.getEntity(t),e),a=at(i,e);return this.params.comparator(r,a)}return null}destroy(t){this.forEachId(t,e=>e.destroy()),t||this._someDirty.complete()}instantiatePlugin(t){return new Ie(this.query,this.params,t)}checkSomeDirty(){const t=this.resolvedIds();for(const e of t)if(this.getEntity(e).isDirty())return!0;return!1}}const di={pagesControls:!1,range:!1,startWith:1,cacheTimeout:void 0,clearStoreWithCache:!0};class $t extends rt{constructor(t,e={}){super(t,{resetFn:()=>{this.initial=!1,this.destroy({clearCache:!0,currentPage:1})}}),this.query=t,this.config=e,this.metadata=new Map,this.pages=new Map,this.pagination={currentPage:1,perPage:0,total:0,lastPage:0,data:[]},this.initial=!0,this.isLoading$=this.query.selectLoading().pipe((0,o.delay)(0)),this.config={...di,...e};const{startWith:i,cacheTimeout:n}=this.config;this.page=new o.BehaviorSubject(i),(0,o.isObservable)(n)&&(this.clearCacheSubscription=n.subscribe(()=>this.clearCache()))}get pageChanges(){return this.page.asObservable()}get currentPage(){return this.pagination.currentPage}get isFirst(){return 1===this.currentPage}get isLast(){return this.currentPage===this.pagination.lastPage}withControls(){return this.config.pagesControls=!0,this}withRange(){return this.config.range=!0,this}setLoading(t=!0){this.getStore().setLoading(t)}update(t){this.pagination=t,this.addPage(t.data)}addPage(t){this.pages.set(this.currentPage,{ids:t.map(e=>e[this.getStore().idKey])}),this.getStore().upsertMany(t)}clearCache(t={}){this.initial||(k("@Pagination - Clear Cache"),!1!==t.clearStore&&(this.config.clearStoreWithCache||t.clearStore)&&this.getStore().remove(),this.pages=new Map,this.metadata=new Map),this.initial=!1}clearPage(t){this.pages.delete(t)}destroy({clearCache:t,currentPage:e}={}){this.clearCacheSubscription&&this.clearCacheSubscription.unsubscribe(),t&&this.clearCache(),x(e)||this.setPage(e),this.initial=!0}isPageActive(t){return this.currentPage===t}setPage(t){(t!==this.currentPage||!this.hasPage(t))&&this.page.next(this.pagination.currentPage=t)}nextPage(){this.currentPage!==this.pagination.lastPage&&this.setPage(this.pagination.currentPage+1)}prevPage(){this.pagination.currentPage>1&&this.setPage(this.pagination.currentPage-1)}setLastPage(){this.setPage(this.pagination.lastPage)}setFirstPage(){this.setPage(1)}hasPage(t){return this.pages.has(t)}getPage(t){let e=this.pagination.currentPage;return this.hasPage(e)?this.selectPage(e):(this.setLoading(!0),(0,o.from)(t()).pipe((0,o.switchMap)(i=>(e=i.currentPage,tt(()=>{this.setLoading(!1),this.update(i)}),this.selectPage(e)))))}getQuery(){return this.query}refreshCurrentPage(){!1===I(this.currentPage)&&(this.clearPage(this.currentPage),this.setPage(this.currentPage))}getFrom(){return this.isFirst?1:(this.currentPage-1)*this.pagination.perPage+1}getTo(){return this.isLast?this.pagination.total:this.currentPage*this.pagination.perPage}selectPage(t){return this.query.selectAll({asObject:!0}).pipe((0,o.take)(1),(0,o.map)(e=>{const i={...this.pagination,data:this.pages.get(t).ids.map(a=>e[a])},{range:n,pagesControls:r}=this.config;return isNaN(this.pagination.total)&&(i.total=1===i.lastPage?i.data?i.data.length:0:i.perPage*i.lastPage,this.pagination.total=i.total),n&&(i.from=this.getFrom(),i.to=this.getTo()),r&&(i.pageControls=function gi(s,t){const e=Math.ceil(s/t),i=[];for(let n=0;n<e;n++)i.push(n+1);return i}(this.pagination.total,this.pagination.perPage)),i}))}}(0,C.Cg)([Kt("@Pagination - New Page"),(0,C.Sn)("design:type",Function),(0,C.Sn)("design:paramtypes",[Object]),(0,C.Sn)("design:returntype",void 0)],$t.prototype,"update",null);const pi=$t;class yi extends rt{constructor(t,e,i={}){super(t),this.query=t,this.factoryFnOrPath=e,this.params=i,this.params={debounceTime:300,formKey:"akitaForm",emitEvent:!1,arrControlFactory:n=>this.builder.control(n),...i},this.isRootKeys=!1===R(e),this.isKeyBased=et(e)||this.isRootKeys}setForm(t,e){return this.form=t,this.builder=e,this.activate(),this}reset(t){let e;e=t||(this.isKeyBased?this.initialValue:this.factoryFnOrPath()),this.isKeyBased&&Object.keys(this.initialValue).forEach(n=>{const r=this.initialValue[n];Array.isArray(r)&&this.builder&&(this.cleanArray(this.form.controls[n]),r.forEach((u,c)=>{this.form.get(n).insert(c,this.params.arrControlFactory(u))}))}),this.form.patchValue(e,{emitEvent:this.params.emitEvent});const i=this.isKeyBased?st(this.getQuery().getValue(),`${this.getStore().storeName}.${this.factoryFnOrPath}`,e):{[this.params.formKey]:e};this.updateStore(i)}cleanArray(t){for(;0!==t.length;)t.removeAt(0)}resolveInitialValue(t,e){if(t)return Object.keys(t).reduce((i,n)=>{const r=e[n];if(Array.isArray(r)&&this.builder){const a=this.params.arrControlFactory;this.cleanArray(this.form.get(n)),r.forEach((u,c)=>{this.form.get(n).insert(c,a(u))})}return i[n]=e[n],i},{})}activate(){let t;if(this.isKeyBased)if(this.isRootKeys)this.initialValue=this.resolveInitialValue(this.form.value,this.getQuery().getValue()),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent});else{t=`${this.getStore().storeName}.${this.factoryFnOrPath}`;const e=it(this.getQuery().getValue(),t);this.initialValue=this.resolveInitialValue(e,e),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent})}else{this.getQuery().getValue()[this.params.formKey]||(k("@PersistNgFormPlugin activate"),this.updateStore({[this.params.formKey]:this.factoryFnOrPath()}));const e=this.getQuery().getValue()[this.params.formKey];this.form.patchValue(e)}this.formChanges=this.form.valueChanges.pipe((0,o.debounceTime)(this.params.debounceTime)).subscribe(e=>{let i;k("@PersistForm - Update"),i=this.isKeyBased?this.isRootKeys?n=>({...n,...e}):n=>st(n,t,e):()=>({[this.params.formKey]:e}),this.updateStore(i(this.getQuery().getValue()))})}destroy(){this.formChanges&&this.formChanges.unsubscribe(),this.form=null,this.builder=null}}class we extends rt{constructor(t,e={},i){super(t,{resetFn:()=>this.clear()}),this.query=t,this.params=e,this._entityId=i,this.skip=!1,this.history={past:[],present:null,future:[]},this.skipUpdate=!1,e.maxAge=e.maxAge?e.maxAge:10,e.comparator=e.comparator||(()=>!0),this.activate()}get hasPast$(){return this._hasPast$}get hasFuture$(){return this._hasFuture$}get hasPast(){return this.history.past.length>0}get hasFuture(){return this.history.future.length>0}get property(){return this.params.watchProperty}updateHasHistory(){this.hasFutureSubject.next(this.hasFuture),this.hasPastSubject.next(this.hasPast)}activate(){this.hasPastSubject=new o.BehaviorSubject(!1),this._hasPast$=this.hasPastSubject.asObservable().pipe((0,o.distinctUntilChanged)()),this.hasFutureSubject=new o.BehaviorSubject(!1),this._hasFuture$=this.hasFutureSubject.asObservable().pipe((0,o.distinctUntilChanged)()),this.history.present=this.getSource(this._entityId,this.property),this.subscription=this.selectSource(this._entityId,this.property).pipe((0,o.pairwise)()).subscribe(([t,e])=>{if(this.skip)return void(this.skip=!1);const i=this.params.comparator(t,e);!this.skipUpdate&&i&&(this.history.past.length===this.params.maxAge&&(this.history.past=this.history.past.slice(1)),this.history.past=[...this.history.past,t],this.history.present=e,this.updateHasHistory())})}undo(){if(this.history.past.length>0){const{past:t,present:e}=this.history,i=t[t.length-1];this.history.past=t.slice(0,t.length-1),this.history.present=i,this.history.future=[e,...this.history.future],this.update()}}redo(){if(this.history.future.length>0){const{past:t,present:e}=this.history,i=this.history.future[0],n=this.history.future.slice(1);this.history.past=[...t,e],this.history.present=i,this.history.future=n,this.update("Redo")}}jumpToPast(t){if(t<0||t>=this.history.past.length)return;const{past:e,future:i,present:n}=this.history,r=e.slice(0,t),a=[...e.slice(t+1),n,...i],u=e[t];this.history.past=r,this.history.present=u,this.history.future=a,this.update()}jumpToFuture(t){if(t<0||t>=this.history.future.length)return;const{past:e,future:i,present:n}=this.history,r=[...e,n,...i.slice(0,t)],a=i[t],u=i.slice(t+1);this.history.past=r,this.history.present=a,this.history.future=u,this.update("Redo")}jump(t){return t>0?this.jumpToFuture(t-1):t<0?this.jumpToPast(this.history.past.length+t):void 0}clear(t){this.history=l(t)?t(this.history):{past:[],present:null,future:[]},this.updateHasHistory()}destroy(t=!1){t&&this.clear(),this.subscription.unsubscribe()}ignoreNext(){this.skip=!0}update(t="Undo"){this.skipUpdate=!0,k(`@StateHistory - ${t}`),this.updateStore(this.history.present,this._entityId,this.property,!0),this.updateHasHistory(),this.skipUpdate=!1}}class mi extends Vt{constructor(t,e={}){super(t,e.entityIds),this.query=t,this.params=e,e.maxAge=R(e.maxAge)?e.maxAge:10,this.activate(),this.selectIds().pipe((0,o.skip)(1)).subscribe(i=>this.activate(i))}redo(t){this.forEachId(t,e=>e.redo())}undo(t){this.forEachId(t,e=>e.undo())}hasPast(t){if(this.hasEntity(t))return this.getEntity(t).hasPast}hasFuture(t){if(this.hasEntity(t))return this.getEntity(t).hasFuture}jumpToFuture(t,e){this.forEachId(t,i=>i.jumpToFuture(e))}jumpToPast(t,e){this.forEachId(t,i=>i.jumpToPast(e))}clear(t,e){this.forEachId(t,i=>i.clear(e))}destroy(t,e=!1){this.forEachId(t,i=>i.destroy(e))}ignoreNext(t){this.forEachId(t,e=>e.ignoreNext())}instantiatePlugin(t){return new we(this.query,this.params,t)}}function Si(s){s=Object.assign({},{exclude:[]},s);const e=Object.keys(v);tt(()=>{for(const i of e){const n=v[i];s.exclude?-1===s.exclude.indexOf(n.storeName)&&n.reset():n.reset()}})}var Dt=function(s){return s.Update="UPDATE",s}(Dt||{});const bi={[Dt.Update]:"update"};var N=function(s){return s.Update="UPDATE",s.AddEntities="ADD_ENTITIES",s.SetEntities="SET_ENTITIES",s.UpdateEntities="UPDATE_ENTITIES",s.RemoveEntities="REMOVE_ENTITIES",s.UpsertEntities="UPSERT_ENTITIES",s.UpsertManyEntities="UPSERT_MANY_ENTITIES",s}(N||{});const Ei={[N.Update]:"update",[N.AddEntities]:"add",[N.SetEntities]:"set",[N.UpdateEntities]:"update",[N.RemoveEntities]:"remove",[N.UpsertEntities]:"upsert",[N.UpsertManyEntities]:"upsertMany"};function jt(s){return St(s[W].storeName)}function St(s){const t=v[s];if(I(t))throw new qe(`${t.storeName} doesn't exist`);return t}function Ce(s){return jt(s)}function Te(s){return St(s)}function vi(s,t,e){const i="string"==typeof s?St(s):jt(s);e(i[bi[t]].bind(i))}function Pi(s,t,e){const i="string"==typeof s?Te(s):Ce(s);e(i[Ei[t]].bind(i))}function Ai(s){return function(t){return(0,o.defer)(()=>(s.setLoading(!0),t.pipe((0,o.finalize)(()=>s.setLoading(!1)))))}}function _i(s){return function(t){return(0,o.defer)(()=>(s.setLoading(!0),s.setError(null),t.pipe((0,o.tap)({error(e){s.setLoading(!1),s.setError(e)},complete(){s.setLoading(!1)}}))))}}class Ue{getStoresSnapshot(t=[]){const e={},n=t.length>0?t:Object.keys(v);for(let r=0;r<n.length;r++){const a=n[r];"router"!==a&&(e[a]=v[a]._value())}return e}setStoresSnapshot(t,e){const i={skipStorageUpdate:!1,lazy:!1,...e};i.skipStorageUpdate&&_e(!0);let n=t;et(t)&&(n=JSON.parse(n));const r=Object.keys(n).length;if(i.lazy)Z.pipe((0,o.filter)(a=>n.hasOwnProperty(a)),(0,o.take)(r)).subscribe(a=>v[a]._setState(()=>n[a]));else for(let a=0,u=Object.keys(n);a<u.length;a++){const c=u[a];v[c]&&v[c]._setState(()=>n[c])}i.skipStorageUpdate&&_e(!1)}}const Ii=new Ue;function wi(s,t=L){const e=[];for(const i of s)e.push(i[t]);return e}function Ci(s){return t=>t.lift(new Ti(s))}class Ti{constructor(t){this.query=t}call(t,e){return e.pipe((0,o.first)(),(0,o.switchMap)(i=>{let n=i[this.query.__store__.config.idKey],r=!1;return(0,o.merge)((0,o.of)({newId:void 0,oldId:n,pending:!1}),this.query.__store__.selectEntityIdChanges$).pipe((0,o.filter)(a=>a.oldId===n),(0,o.tap)(a=>r=a.pending),(0,o.filter)(a=>a.newId!==n&&!r),(0,o.switchMap)(a=>this.query.selectEntity(n=a.newId||n).pipe((0,o.filter)(()=>!r))))})).subscribe(t)}}}}]);