(self.webpackChunkdashboard=self.webpackChunkdashboard||[]).push([[1023,3404],{1023:(Le,Dt,ct)=>{ct.r(Dt),ct.d(Dt,{$$addStore:()=>u,$$deleteStore:()=>c,$$updateStore:()=>l,AkitaPlugin:()=>xt,DEFAULT_ID_KEY:()=>et,DirtyCheckPlugin:()=>$e,EntityActions:()=>at,EntityCollectionPlugin:()=>oe,EntityDirtyCheckPlugin:()=>di,EntityService:()=>Qe,EntityStateHistoryPlugin:()=>mi,EntityStore:()=>ot,EntityStoreAction:()=>st,EntityUIQuery:()=>Oe,EntityUIStore:()=>ne,Order:()=>Q,Paginator:()=>gi,PaginatorPlugin:()=>ue,PersistNgFormPlugin:()=>bi,Query:()=>re,QueryConfig:()=>ti,QueryEntity:()=>Qt,SnapshotManager:()=>Re,StateHistoryPlugin:()=>Ne,Store:()=>se,StoreAction:()=>ce,StoreConfig:()=>Je,__DEV__:()=>Ht,__stores__:()=>C,action:()=>$t,addEntities:()=>dt,akitaConfig:()=>te,akitaDevtools:()=>W,applyTransaction:()=>Tt,arrayAdd:()=>vt,arrayFind:()=>Bt,arrayRemove:()=>At,arrayToggle:()=>Gt,arrayUpdate:()=>Rt,arrayUpsert:()=>Xt,byId:()=>Jt,byKey:()=>Mt,cacheable:()=>Yt,coerceArray:()=>I,combineQueries:()=>Zt,commit:()=>Te,compareValues:()=>fe,configKey:()=>pt,createEntityQuery:()=>ai,createEntityStore:()=>ri,createQuery:()=>ni,createStore:()=>si,currentAction:()=>X,dirtyCheckDefaultParams:()=>ae,dispatchAdded:()=>b,dispatchDeleted:()=>f,dispatchUpdate:()=>P,distinctUntilArrayItemChanged:()=>Pt,enableAkitaProdMode:()=>qe,endBatch:()=>Ie,entitiesToArray:()=>de,entitiesToMap:()=>ye,filterNil:()=>Ye,filterNilValue:()=>je,find:()=>wt,getActiveEntities:()=>pe,getAkitaConfig:()=>It,getEntityStore:()=>Be,getEntityStoreByName:()=>Me,getExitingActives:()=>Nt,getInitialEntitiesState:()=>ge,getNestedPath:()=>Ot,getStore:()=>he,getStoreByName:()=>qt,getValue:()=>Ut,guid:()=>oi,hasActiveState:()=>_t,hasEntity:()=>rt,isArray:()=>B,isDefined:()=>a,isDev:()=>F,isEmpty:()=>L,isEntityState:()=>Ee,isFunction:()=>S,isMultiActiveState:()=>lt,isNil:()=>R,isNotBrowser:()=>m,isNumber:()=>ui,isObject:()=>Y,isPlainObject:()=>Kt,isString:()=>Ct,isTransactionInProcess:()=>ee,isUndefined:()=>J,logAction:()=>H,persistState:()=>fi,queryConfigKey:()=>Lt,removeAllEntities:()=>me,removeEntities:()=>be,resetCustomAction:()=>ht,resetStores:()=>Si,resolveActiveEntity:()=>ft,runEntityStoreAction:()=>wi,runStoreAction:()=>vi,selectPersistStateInit:()=>ci,setAction:()=>D,setEntities:()=>ve,setLoading:()=>Pi,setLoadingAndError:()=>Ai,setSkipAction:()=>Vt,setValue:()=>jt,snapshotManager:()=>Ii,sortByOptions:()=>xe,startBatch:()=>Ae,toBoolean:()=>ut,toEntitiesIds:()=>Ti,toEntitiesObject:()=>Se,trackIdChanges:()=>Ci,transaction:()=>ie,transactionManager:()=>it,updateEntities:()=>Ce,withTransaction:()=>Xe});const X={type:null,entityIds:null,skip:!1,payload:null};let Et=!1;function ht(){Et=!1}function H(s,t,e){D(s,t,e),Et=!0}function D(s,t,e){!1===Et&&(X.type=s,X.entityIds=t,X.payload=e)}function Vt(s=!0){X.skip=s}function $t(s,t){return function(e,i,n){const o=n.value;return n.value=function(...h){return H(s,t),o.apply(this,h)},n}}function rt(s,t){return s.hasOwnProperty(t)}function B(s){return Array.isArray(s)}function _t(s){return s.hasOwnProperty("active")}function lt(s){return B(s)}function ft({active:s,ids:t,entities:e}){return lt(s)?Nt(s,t):!1===rt(e,s)?null:s}function Nt(s,t){const e=s.filter(i=>t.indexOf(i)>-1);return e.length===s.length?s:e}function dt({state:s,entities:t,idKey:e,options:i={},preAddEntity:n}){let o={},h=[],y=!1;for(const g of t)if(!1===rt(s.entities,g[e])){const p=n(g),v=p[e];o[v]=p,i.prepend?h.unshift(v):h.push(v),y=!0}return y?{newState:{...s,entities:{...s.entities,...o},ids:i.prepend?[...h,...s.ids]:[...s.ids,...h]},newIds:h}:null}function R(s){return null==s}function I(s){return R(s)?[]:Array.isArray(s)?s:[s]}function vt(s,t,e={}){const i=I(t),n=s||[];return e.prepend?[...i,...n]:[...n,...i]}var d=ct(4866);const et="id";function L(s){return!!B(s)&&0===s.length}function S(s){return"function"==typeof s}function wt(s,t,e){const i=[];if(S(t))for(const n of s)!0===t(n)&&i.push(n);else{const n=I(t).reduce((o,h)=>o.add(h),new Set);for(const o of s)n.has(o[e])&&i.push(o)}return i}function Pt(){return(0,d.distinctUntilChanged)((s,t)=>s===t||!(!B(s)||!B(t))&&(!(!L(s)||!L(t))||s.length===t.length&&!1===t.some((i,n)=>s[n]!==i)))}function Bt(s,t){return function(e){return e.pipe((0,d.map)(i=>!1===B(i)?i:wt(i,s,t||et)),Pt(),(0,d.map)(i=>!1===B(i)||B(s)||S(s)?i:i[0]))}}function Y(s){const t=typeof s;return null!=s&&("object"==t||"function"==t)}function At(s,t,e=et){let i,n;if(S(t)?n=function Wt(s){return function(...t){return!s(...t)}}(t):(i=I(t),n=o=>!1===i.includes(Y(o)?o[e]:o)),Array.isArray(s))return s.filter(n)}function Mt(s){return(t,e)=>t[s]===e[s]}function Jt(){return Mt("id")}function Gt(s,t,e=(i,n)=>i===n){const i=s.findIndex(n=>e(t,n));return~i?[...s.slice(0,i),...s.slice(i+1)]:[...s,t]}function Rt(s,t,e,i=et){let n;if(S(t))n=t;else{const h=I(t);n=y=>!0===h.includes(Y(y)?y[i]:y)}return s.map((y,g)=>!0===n(y,g)?Y(y)?{...y,...e}:e:y)}function Xt(s,t,e,i=et){const n=Y(e);return s.some(h=>n?h[i]===t:h===t)?Rt(s,t,e,i):vt(s,n?{...e,[i]:t}:e)}function Yt(s,t,e={emitNext:!1}){return s._cache().value?e.emitNext?(0,d.of)(void 0):d.EMPTY:t}function Zt(s){return(0,d.combineLatest)(s).pipe((0,d.auditTime)(0))}let yt={resettable:!1,ttl:null,producerFn:void 0};function te(s){yt={...yt,...s}}function It(){return yt}function a(s){return!1===R(s)}const c=new d.Subject,u=new d.ReplaySubject(50,5e3),l=new d.Subject;function f(s){c.next(s)}function b(s){u.next(s)}function P(s,t){l.next({storeName:s,action:t})}const V=typeof window<"u",m=!V,x=()=>{try{return typeof localStorage<"u"}catch{return!1}},$=()=>{try{return typeof sessionStorage<"u"}catch{return!1}},C={},U={};function M(s){return s&&s.charAt(0).toUpperCase()+s.slice(1)}V&&(window.$$stores=C,window.$$queries=U);let N=[];function W(s,t={}){if(m||!window.__REDUX_DEVTOOLS_EXTENSION__)return;N.length&&N.forEach(p=>{p.unsubscribe?p.unsubscribe():p&&p()}),s&&s.run||((s=s||{}).run=p=>p(),t=s);const n=Object.assign({},{name:"Akita",shallow:!0,storesWhitelist:[]},t),o=n.storesWhitelist,h=window.__REDUX_DEVTOOLS_EXTENSION__.connect(n);let y={};const g=p=>!o.length||o.indexOf(p)>-1;N.push(u.subscribe(p=>{!1!==g(p)&&(y={...y,[p]:C[p]._value()},h.send({type:`[${M(p)}] - @@INIT`},y))})),N.push(c.subscribe(p=>{!1!==g(p)&&(delete y[p],h.send({type:`[${p}] - Delete Store`},y))})),N.push(l.subscribe(({storeName:p,action:v})=>{if(!1===g(p))return;const{type:E,entityIds:w,skip:O,...j}=v,Z=j.payload;if(O)return void Vt(!1);const z=C[p];if(!z||!1===t.shallow&&y[p]&&JSON.stringify(z._value())===JSON.stringify(y[p]))return;y={...y,[p]:z._value()};const tt=M(p);let G=a(w)?`[${tt}] - ${E} (ids: ${w})`:`[${tt}] - ${E}`;if(t.logTrace&&(console.group(G),console.trace(),console.groupEnd()),t.sortAlphabetically){const Ft=Object.keys(y).sort().reduce((gt,bt)=>(gt[bt]=y[bt],gt),{});h.send({type:G,...Z},Ft)}else h.send({type:G,...Z},y)})),N.push(h.subscribe(p=>{if("DISPATCH"===p.type){if("COMMIT"===p.payload.type)return void h.init(y);if(p.state){const E=JSON.parse(p.state);for(let w=0,O=Object.keys(E);w<O.length;w++){const j=O[w];C[j]&&s.run(()=>{C[j]._setState(()=>E[j],!1)})}}}}))}var Q=function(s){return s.ASC="asc",s.DESC="desc",s}(Q||{});function fe(s,t=Q.ASC){return function(e,i){if(!e.hasOwnProperty(s)||!i.hasOwnProperty(s))return 0;const n="string"==typeof e[s]?e[s].toUpperCase():e[s],o="string"==typeof i[s]?i[s].toUpperCase():i[s];let h=0;return n>o?h=1:n<o&&(h=-1),t==Q.DESC?-1*h:h}}function de(s,t){let e=[];const{ids:i,entities:n}=s,{filterBy:o,limitTo:h,sortBy:y,sortByOrder:g}=t;for(let v=0;v<i.length;v++){const E=n[i[v]];o?I(o).every(j=>j(E,v))&&e.push(E):e.push(E)}if(y){let v=S(y)?y:fe(y,g);e=e.sort((E,w)=>v(E,w,s))}const p=Math.min(h||e.length,e.length);return p===e.length?e:e.slice(0,p)}function ye(s,t){const e={},{filterBy:i,limitTo:n}=t,{ids:o,entities:h}=s;if(!i&&!n)return h;const y=!1===R(n);if(i&&y){let g=0;for(let p=0,v=o.length;p<v&&g!==n;p++){const E=o[p],w=h[E];I(i).every(j=>j(w,p))&&(e[E]=w,g++)}}else{const g=Math.min(n||o.length,o.length);for(let p=0;p<g;p++){const v=o[p],E=h[v];i?I(i).every(O=>O(E,p))&&(e[v]=E):e[v]=E}}return e}var at=function(s){return s.Set="Set",s.Add="Add",s.Update="Update",s.Remove="Remove",s}(at||{});class Qe{}var q=ct(1635);let Ht=!0;function qe(){Ht=!1,V&&(delete window.$$stores,delete window.$$queries)}function F(){return Ht}function pe(s,t,e){let i;if(B(s))i=s;else if(Y(s)){if(R(e))return;s=Object.assign({wrap:!0},s);const n=t.indexOf(e);if(s.prev){const o=0===n;if(o&&!s.wrap)return;i=o?t[t.length-1]:t[n-1]}else if(s.next){const o=t.length===n+1;if(o&&!s.wrap)return;i=o?t[0]:t[n+1]}}else{if(s===e)return;i=s}return i}const ge=()=>({entities:{},ids:[],loading:!0,error:null});function J(s){return void 0===s}function be({state:s,ids:t}){if(R(t))return me(s);const e=s.entities;let i={};for(const o of s.ids)!1===t.includes(o)&&(i[o]=e[o]);const n={...s,entities:i,ids:s.ids.filter(o=>!1===t.includes(o))};return _t(s)&&(n.active=ft(n)),n}function me(s){return{...s,entities:{},ids:[],active:lt(s.active)?[]:null}}function Se(s,t,e){const i={entities:{},ids:[]};for(const n of s){const o=e(n);i.entities[o[t]]=o,i.ids.push(o[t])}return i}function Ee(s){return s.entities&&s.ids}function _e(s,t){let e={};for(const i of Object.keys(s))e[i]=t(s[i]);return e}function ve({state:s,entities:t,idKey:e,preAddEntity:i,isNativePreAdd:n}){let o,h;if(B(t)){const g=Se(t,e,i);o=g.entities,h=g.ids}else Ee(t)?(o=n?t.entities:_e(t.entities,i),h=t.ids):(o=n?t:_e(t,i),h=Object.keys(o).map(g=>isNaN(g)?g:Number(g)));const y={...s,entities:o,ids:h,loading:!1};return _t(s)&&(y.active=ft(y)),y}function we(s){Object.freeze(s);const t="function"==typeof s,e=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(s).forEach(function(i){e.call(s,i)&&(!t||"caller"!==i&&"callee"!==i&&"arguments"!==i)&&null!==s[i]&&("object"==typeof s[i]||"function"==typeof s[i])&&!Object.isFrozen(s[i])&&we(s[i])}),s}class ze extends Error{constructor(t){super(t)}}function ut(s){return null!=s&&"false"!=`${s}`}function Kt(s){return ut(s)&&"Object"===s.constructor.name}const pt="akitaConfig";function Je(s){return function(t){t[pt]={idKey:"id"};for(let e=0,i=Object.keys(s);e<i.length;e++){const n=i[e];"name"===n?t[pt].storeName=s[n]:t[pt][n]=s[n]}}}const Ge=new d.Subject,Pe=new d.BehaviorSubject(!1),it={activeTransactions:0,batchTransaction:null};function Ae(){ee()||(it.batchTransaction=new d.Subject),it.activeTransactions++,Pe.next(!0)}function Ie(){0==--it.activeTransactions&&(it.batchTransaction.next(!0),it.batchTransaction.complete(),Pe.next(!1),Ge.next(!0))}function ee(){return it.activeTransactions>0}function Te(){return it.batchTransaction?it.batchTransaction.asObservable():(0,d.of)(!0)}function Tt(s,t=void 0){Ae();try{return s.apply(t)}finally{H("@Transaction"),Ie()}}function ie(){return function(s,t,e){const i=e.value;return e.value=function(...n){return Tt(()=>i.apply(this,n),this)},e}}function Xe(s){return function(t){return t.pipe((0,d.tap)(e=>Tt(()=>s(e))))}}class se{constructor(t,e={}){this.options=e,this.inTransaction=!1,this.cache={active:new d.BehaviorSubject(!1),ttl:null},this.onInit(t)}setLoading(t=!1){t!==this._value().loading&&(F()&&D("Set Loading"),this._setState(e=>({...e,loading:t})))}setHasCache(t,e={restartTTL:!1}){if(t!==this.cache.active.value&&this.cache.active.next(t),e.restartTTL){const i=this.getCacheTTL();i&&(null!==this.cache.ttl&&clearTimeout(this.cache.ttl),this.cache.ttl=setTimeout(()=>this.setHasCache(!1),i))}}getValue(){return this.storeValue}setError(t){t!==this._value().error&&(F()&&D("Set Error"),this._setState(e=>({...e,error:t})))}_select(t){return this.store.asObservable().pipe((0,d.map)(e=>t(e.state)),(0,d.distinctUntilChanged)())}_value(){return this.storeValue}_cache(){return this.cache.active}get config(){return this.constructor[pt]||{}}get storeName(){return this.config.storeName||this.options.storeName||this.options.name}get deepFreeze(){return this.config.deepFreezeFn||this.options.deepFreezeFn||we}get cacheConfig(){return this.config.cache||this.options.cache}get _producerFn(){return this.config.producerFn||this.options.producerFn||function r(){return yt.producerFn}()}get resettable(){return a(this.config.resettable)?this.config.resettable:this.options.resettable}_setState(t,e=!0){if(S(t)){const i=t(this._value());this.storeValue=Ht?this.deepFreeze(i):i}else this.storeValue=t;if(!this.store)return this.store=new d.BehaviorSubject({state:this.storeValue}),void(F()&&this.store.subscribe(({action:i})=>{i&&P(this.storeName,i)}));ee()?this.handleTransaction():this.dispatch(this.storeValue,e)}reset(){this.isResettable()&&(F()&&D("Reset"),this._setState(()=>Object.assign({},this._initialState)),this.setHasCache(!1))}update(t){let e;F()&&D("Update");const i=this._value();e=S(t)?S(this._producerFn)?this._producerFn(i,t):t(i):t;const n=this.akitaPreUpdate(i,{...i,...e}),o=Kt(i)?n:new i.constructor(n);this._setState(o)}updateStoreConfig(t){this.options={...this.options,...t}}akitaPreUpdate(t,e){return e}destroy(){(!V||!window.hmrEnabled)&&this===C[this.storeName]&&(delete C[this.storeName],f(this.storeName),this.setHasCache(!1),this.cache.active.complete(),this.store.complete())}onInit(t){C[this.storeName]=this,this._setState(()=>t),b(this.storeName),this.isResettable()&&(this._initialState=t),F()&&function We(s,t){s||console.error(`@StoreConfig({ name }) is missing in ${t}`)}(this.storeName,this.constructor.name)}dispatch(t,e=!0){let i;e&&(i=X,ht()),this.store.next({state:t,action:i})}watchTransaction(){Te().subscribe(()=>{this.inTransaction=!1,this.dispatch(this._value())})}isResettable(){return!1!==this.resettable&&(this.resettable||It().resettable)}handleTransaction(){this.inTransaction||(this.watchTransaction(),this.inTransaction=!0)}getCacheTTL(){return this.cacheConfig&&this.cacheConfig.ttl||It().ttl}}function Ce({state:s,ids:t,idKey:e,newStateOrFn:i,preUpdateEntity:n,producerFn:o,onEntityIdChanges:h}){const y={};let p,g=!1;for(const w of t){if(!1===rt(s.entities,w))continue;const O=s.entities[w];let j;j=S(i)?S(o)?o(O,i):i(O):i;const Z=j.hasOwnProperty(e)&&j[e]!==O[e];let z;p=w,Z&&(g=!0,p=j[e]);const tt={...O,...j};z=Kt(O)?tt:Kt(j)?new O.constructor(tt):new j.constructor(tt),y[p]=n(O,z)}let v=s.ids,E=s.entities;if(g){const[w]=t,{[w]:O,...j}=s.entities;E=j,v=s.ids.map(Z=>Z===w?p:Z),h(w,p)}return{...s,entities:{...E,...y},ids:v}}var Ue;class ot extends se{constructor(t={},e={}){super({...ge(),...t},e),this.options=e,this.entityActions=new d.Subject,this.entityIdChanges=new d.Subject}get selectEntityAction$(){return this.entityActions.asObservable()}get selectEntityIdChanges$(){return this.entityIdChanges.asObservable()}get idKey(){return this.config.idKey||this.options.idKey||et}set(t,e={}){if(R(t))return;F()&&D("Set Entity");const i=this.akitaPreAddEntity===ot.prototype.akitaPreAddEntity;this.setHasCache(!0,{restartTTL:!0}),this._setState(n=>{const o=ve({state:n,entities:t,idKey:this.idKey,preAddEntity:this.akitaPreAddEntity.bind(this),isNativePreAdd:i});return!1===J(e.activeId)&&(o.active=e.activeId),o}),this.hasInitialUIState()&&this.handleUICreation(),this.entityActions.next({type:at.Set,ids:this.ids})}add(t,e={loading:!1}){const i=I(t);if(L(i))return;const n=dt({state:this._value(),preAddEntity:this.akitaPreAddEntity.bind(this),entities:i,idKey:this.idKey,options:e});n&&(F()&&D("Add Entity"),n.newState.loading=e.loading,this._setState(()=>n.newState),this.hasInitialUIState()&&this.handleUICreation(!0),this.entityActions.next({type:at.Add,ids:n.newIds}))}update(t,e){if(J(e))return void super.update(t);let n,i=[];i=S(t)?this.ids.filter(o=>t(this.entities[o])):R(t)?this.ids:I(t),L(i)||(F()&&D("Update Entity",i),this._setState(o=>Ce({idKey:this.idKey,ids:i,preUpdateEntity:this.akitaPreUpdateEntity.bind(this),state:o,newStateOrFn:e,producerFn:this._producerFn,onEntityIdChanges:(h,y)=>{n={oldId:h,newId:y},this.entityIdChanges.next({...n,pending:!0})}})),n&&this.entityIdChanges.next({...n,pending:!1}),this.entityActions.next({type:at.Update,ids:i}))}upsert(t,e,i,n={}){const o=I(t),h=E=>w=>rt(this.entities,w)===E,y=S(i)?n.baseClass:i?i.baseClass:void 0,g=S(y),p=o.filter(h(!0)),v=o.filter(h(!1)).map(E=>{const w="function"==typeof e?e({}):e,j={...S(i)?i(E,w):w,[this.idKey]:E};return g?new y(j):j});this.update(p,e),this.add(v),F()&&H("Upsert Entity")}upsertMany(t,e={}){const i=[],n=[],o={};for(const h of t){const y=this.akitaPreCheckEntity(h),g=y[this.idKey];if(rt(this.entities,g)){const p=this._value().entities[g],v={...this._value().entities[g],...y},E=e.baseClass?new e.baseClass(v):v,w=this.akitaPreUpdateEntity(p,E),O=w[this.idKey];o[O]=w,n.push(O)}else{const p=e.baseClass?new e.baseClass(y):y,v=this.akitaPreAddEntity(p),E=v[this.idKey];i.push(E),o[E]=v}}F()&&H("Upsert Many"),this._setState(h=>({...h,ids:i.length?[...h.ids,...i]:h.ids,entities:{...h.entities,...o},loading:!!e.loading})),n.length&&this.entityActions.next({type:at.Update,ids:n}),i.length&&this.entityActions.next({type:at.Add,ids:i}),i.length&&this.hasUIStore()&&this.handleUICreation(!0)}replace(t,e){const i=I(t);if(L(i))return;const n={};for(const o of i)n[o]={...e,[this.idKey]:o};F()&&D("Replace Entity",t),this._setState(o=>({...o,entities:{...o.entities,...n}}))}move(t,e){const i=this.ids.slice();i.splice(e<0?i.length+e:e,0,i.splice(t,1)[0]),F()&&D("Move Entity"),this._setState(n=>({...n,entities:{...n.entities},ids:i}))}remove(t){if(L(this.ids))return;const e=a(t);let i=[];i=S(t)?this.ids.filter(n=>t(this.entities[n])):e?I(t):this.ids,!L(i)&&(F()&&D("Remove Entity",i),this._setState(n=>be({state:n,ids:i})),e||this.setHasCache(!1),this.handleUIRemove(i),this.entityActions.next({type:at.Remove,ids:i}))}updateActive(t){const e=I(this.active);F()&&D("Update Active",e),this.update(e,t)}setActive(t){const e=pe(t,this.ids,this.active);void 0!==e&&(F()&&D("Set Active",e),this._setActive(e))}addActive(t){const e=I(t);L(e)||e.every(n=>this.active.indexOf(n)>-1)||(F()&&D("Add Active",t),this._setState(n=>{const o=Array.from(new Set([...n.active,...e]));return{...n,active:o}}))}removeActive(t){const e=I(t);L(e)||!e.some(n=>this.active.indexOf(n)>-1)||(F()&&D("Remove Active",t),this._setState(n=>({...n,active:Array.isArray(n.active)?n.active.filter(o=>-1===e.indexOf(o)):null})))}toggleActive(t){const e=I(t),i=h=>y=>this.active.includes(y)===h,n=e.filter(i(!0)),o=e.filter(i(!1));this.removeActive(n),this.addActive(o),F()&&H("Toggle Active")}createUIStore(t={},e={}){return this.ui=new ne(t,{name:`UI/${this.storeName}`,idKey:this.idKey,...e}),this.ui}destroy(){super.destroy(),this.ui instanceof ot&&this.ui.destroy(),this.entityActions.complete()}akitaPreUpdateEntity(t,e){return e}akitaPreAddEntity(t){return t}akitaPreCheckEntity(t){return t}get ids(){return this._value().ids}get entities(){return this._value().entities}get active(){return this._value().active}_setActive(t){this._setState(e=>({...e,active:t}))}handleUICreation(t=!1){const e=this.ids,i=S(this.ui._akitaCreateEntityFn);let n;const o=h=>{const y=this.entities[h],g=i?this.ui._akitaCreateEntityFn(y):this.ui._akitaCreateEntityFn;return{[this.idKey]:y[this.idKey],...g}};n=t?this.ids.filter(h=>J(this.ui.entities[h])).map(o):e.map(o),t?this.ui.add(n):this.ui.set(n)}hasInitialUIState(){return this.hasUIStore()&&!1===J(this.ui._akitaCreateEntityFn)}handleUIRemove(t){this.hasUIStore()&&this.ui.remove(t)}hasUIStore(){return this.ui instanceof ne}}(0,q.Cg)([ie(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[Object,Object,Object,Object]),(0,q.Sn)("design:returntype",void 0)],ot.prototype,"upsert",null),(0,q.Cg)([ie(),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",["function"==typeof(Ue=typeof T<"u"&&T)?Ue:Object]),(0,q.Sn)("design:returntype",void 0)],ot.prototype,"toggleActive",null);class ne extends ot{constructor(t={},e={}){super(t,e)}setInitialEntityState(t){this._akitaCreateEntityFn=t}}const Ye=s=>s.pipe((0,d.filter)(t=>null!==t&&typeof t<"u"));function je(){return(0,d.filter)(s=>null!=s)}function Ct(s){return"string"==typeof s}const Lt="akitaQueryConfig";function ti(s){return function(t){t[Lt]={};for(let e=0,i=Object.keys(s);e<i.length;e++){const n=i[e];t[Lt][n]=s[n]}}}class re{constructor(t){this.store=t,this.__store__=t,F()&&(U[t.storeName]=this)}select(t){let e;if(S(t))e=t;else if(Ct(t))e=i=>i[t];else{if(Array.isArray(t))return this.store._select(i=>i).pipe((0,d.distinctUntilChanged)(function Ze(s){return function(t,e){const i=S(s[0]);return!1===s.some(n=>i?n(t)!==n(e):t[n]!==e[n])}}(t)),(0,d.map)(i=>S(t[0])?t.map(n=>n(i)):t.reduce((n,o)=>(n[o]=i[o],n),{})));e=i=>i}return this.store._select(e)}selectLoading(){return this.select(t=>t.loading)}selectError(){return this.select(t=>t.error)}getValue(){return this.store._value()}selectHasCache(){return this.store._cache().asObservable()}getHasCache(){return this.store._cache().value}get config(){return this.constructor[Lt]}}function ke(s,t){return function(e){const i=e[s];if(!J(i))return t?Ct(t)?i[t]:t(i):i}}function xe(s,t){s.sortBy=s.sortBy||t&&t.sortBy,s.sortByOrder=s.sortByOrder||t&&t.sortByOrder}class Qt extends re{constructor(t,e={}){super(t),this.options=e,this.__store__=t}selectAll(t={asObject:!1}){return this.select(e=>e.entities).pipe((0,d.map)(()=>this.getAll(t)))}getAll(t={asObject:!1,filterBy:void 0,limitTo:void 0}){return t.asObject?ye(this.getValue(),t):(xe(t,this.config||this.options),de(this.getValue(),t))}selectMany(t,e){return t&&t.length?this.select(i=>i.entities).pipe((0,d.map)(i=>function ii(s,t){return s.reduce((e,i,n,o)=>{const h=t(i,n,o);return void 0!==h&&e.push(h),e},[])}(t,n=>ke(n,e)(i))),Pt()):(0,d.of)([])}selectEntity(t,e){let i=t;return S(t)&&(i=function ei(s,t){for(const e of Object.keys(t))if(!0===s(t[e]))return e}(t,this.getValue().entities)),this.select(n=>n.entities).pipe((0,d.map)(ke(i,e)),(0,d.distinctUntilChanged)())}getEntity(t){return this.getValue().entities[t]}selectActiveId(){return this.select(t=>t.active)}getActiveId(){return this.getValue().active}selectActive(t){return B(this.getActive())?this.selectActiveId().pipe((0,d.switchMap)(e=>this.selectMany(e,t))):this.selectActiveId().pipe((0,d.switchMap)(e=>this.selectEntity(e,t)))}getActive(){const t=this.getActiveId();return B(t)?t.map(e=>this.getValue().entities[e]):ut(t)?this.getEntity(t):void 0}selectCount(t){return this.select(e=>e.entities).pipe((0,d.map)(()=>this.getCount(t)))}getCount(t){return S(t)?this.getAll().filter(t).length:this.getValue().ids.length}selectLast(t){return this.selectAt(e=>e[e.length-1],t)}selectFirst(t){return this.selectAt(e=>e[0],t)}selectEntityAction(t){if(R(t))return this.store.selectEntityAction$;const e=B(t)?n=>n:({ids:n})=>n,i=I(t);return this.store.selectEntityAction$.pipe((0,d.filter)(({type:n})=>i.includes(n)),(0,d.map)(n=>e(n)))}hasEntity(t){return R(t)?this.getValue().ids.length>0:S(t)?this.getAll().some(t):B(t)?t.every(e=>e in this.getValue().entities):t in this.getValue().entities}hasActive(t){const e=this.getValue().active,i=a(t);return Array.isArray(e)?i?e.includes(t):e.length>0:i?e===t:a(e)}createUIQuery(){this.ui=new Oe(this.__store__.ui)}selectAt(t,e){return this.select(i=>i.ids).pipe((0,d.map)(t),(0,d.distinctUntilChanged)(),(0,d.switchMap)(i=>this.selectEntity(i,e)))}}class Oe extends Qt{constructor(t){super(t)}}function si(s,t){return new se(s,t)}function ni(s){return new re(s)}function ri(s,t){return new ot(s,t)}function ai(s,t={}){return new Qt(s,t)}function Ut(s,t){return 1===t.split(".").length?s:t.split(".").slice(1).join(".").split(".").reduce((i,n)=>i&&i[n],s)}function oi(){return Math.random().toString(36).slice(2)}function ui(s){return!B(s)&&s-parseFloat(s)+1>=0}function jt(s,t,e,i=!1){const n=t.split(".");if(1===n.length)return{...s,...e};s={...s};const o=n.length-2;return t.split(".").slice(1).reduce((y,g,p)=>p!==o?(y[g]={...y[g]},y&&y[g]):(y[g]=i||Array.isArray(y[g])||!Y(y[g])?e:{...y[g],...e},y&&y[g]),s),s}let Fe=!1;const De=new d.ReplaySubject(1);function ci(){return De.asObservable()}function Ve(s){Fe=s}function hi(){return Fe}function kt(s){return function li(s){return s&&S(s.then)}(s)||(0,d.isObservable)(s)?(0,d.from)(s):(0,d.of)(s)}function fi(s){const t={key:"AkitaStores",enableInNonBrowser:!1,storage:x()?localStorage:s.storage,deserialize:JSON.parse,serialize:JSON.stringify,include:[],select:[],persistOnDestroy:!1,preStorageUpdate:function(k,A){return A},preStoreUpdate:function(k,A){return A},skipStorageUpdate:hi,preStorageUpdateOperator:()=>k=>k},{storage:e,enableInNonBrowser:i,deserialize:n,serialize:o,include:h,select:y,key:g,preStorageUpdate:p,persistOnDestroy:v,preStorageUpdateOperator:E,preStoreUpdate:w,skipStorageUpdate:O}=Object.assign({},t,s);if(m&&!i||!e)return;const j=h.length>0,Z=y.length>0;let z,tt;j&&(z=h.reduce((k,A)=>(S(A)?k.fns.push(A):k[A.split(".")[0]]=A,k),{fns:[]})),Z&&(tt=y.reduce((k,A)=>(k[A.storeName]=A,k),{}));let G={};const Ft={},gt=[],bt=[];function He(k){kt(k).subscribe(()=>{const A=bt.shift();A&&He(A)})}const ji=x()&&e===localStorage||$()&&e===sessionStorage;return kt(e.getItem(g)).subscribe(k=>{let A=Y(k)?k:n(k||"{}");function nt(_){A.$cache={...A.$cache||{},..._},A=Object.assign({},A,Ft),bt.push(e.setItem(g,ji?o(A):A)),He(bt.shift())}function mt(_,St){G[_]=C[_]._select(K=>Ut(K,St)).pipe((0,d.skip)(1),(0,d.map)(K=>Z&&tt[_]?tt[_](K):K),(0,d.filter)(()=>!1===O()),E()).subscribe(K=>{Ft[_]=p(_,K),Promise.resolve().then(()=>nt({[_]:C[_]._cache().getValue()}))})}function le(_,St,K){_ in A&&(D("@PersistState"),St._setState(zt=>jt(zt,K,w(_,A[_],zt))),C[_].setHasCache(!!A.$cache&&A.$cache[_],{restartTTL:!0}))}gt.push(c.subscribe(_=>{G[_]&&(!1===v&&nt({[_]:!1}),G[_].unsubscribe(),delete G[_])})),gt.push(u.subscribe(_=>{if("router"===_)return;const St=C[_];if(j){let K=z[_];if(!K){if(!z.fns.some(zt=>zt(_)))return;K=_}le(_,St,K),mt(_,K)}else le(_,St,_),mt(_,_)})),De.next(!0)}),{destroy(){gt.forEach(k=>k.unsubscribe());for(let k=0,A=Object.keys(G);k<A.length;k++)G[A[k]].unsubscribe();G={}},clear(){e.clear()},clearStore(k){R(k)?kt(e.setItem(g,"{}")).subscribe():kt(e.getItem(g)).subscribe(nt=>{const mt=n(nt||"{}");mt[k]&&(delete mt[k],kt(e.setItem(g,o(mt))).subscribe())})}}}class xt{constructor(t,e){this.query=t,e&&e.resetFn&&It().resettable&&this.onReset(e.resetFn)}getQuery(){return this.query}getStore(){return this.getQuery().__store__}isEntityBased(t){return ut(t)}selectSource(t,e){return this.isEntityBased(t)?this.getQuery().selectEntity(t).pipe(je()):e?this.getQuery().select(i=>Ut(i,this.withStoreName(e))):this.getQuery().select()}getSource(t,e){if(this.isEntityBased(t))return this.getQuery().getEntity(t);const i=this.getQuery().getValue();return e?Ut(i,this.withStoreName(e)):i}withStoreName(t){return`${this.storeName}.${t}`}get storeName(){return this.getStore().storeName}updateStore(t,e,i,n=!1){if(this.isEntityBased(e)){const o=this.getStore();n?o.replace(e,t):o.update(e,t)}else{if(i)return void this.getStore()._setState(h=>jt(h,this.withStoreName(i),t,!0));const o=n?t:h=>({...h,...t});this.getStore()._setState(o)}}onReset(t){const e=this.getStore().reset;this.getStore().reset=(...i)=>{setTimeout(()=>{e.apply(this.getStore(),i),t()})}}}const ae={comparator:(s,t)=>JSON.stringify(s)!==JSON.stringify(t)};function Ot(s,t){return t.split(".").reduce((i,n)=>i&&"undefined"!==i[n]?i[n]:void 0,s)}class $e extends xt{constructor(t,e,i){if(super(t),this.query=t,this.params=e,this._entityId=i,this.dirty=new d.BehaviorSubject(!1),this.active=!1,this._reset=new d.Subject,this.isDirty$=this.dirty.asObservable().pipe((0,d.distinctUntilChanged)()),this.reset$=this._reset.asObservable(),this.params={...ae,...e},this.params.watchProperty){const n=I(this.params.watchProperty);t instanceof Qt&&n.includes("entities")&&!n.includes("ids")&&n.push("ids"),this.params.watchProperty=n}}reset(t={}){let e=this.head;S(t.updateFn)&&(e=this.isEntityBased(this._entityId)?t.updateFn(this.head,this.getQuery().getEntity(this._entityId)):t.updateFn(this.head,this.getQuery().getValue())),H("@DirtyCheck - Revert"),this.updateStore(e,this._entityId),this._reset.next(!0)}setHead(){return this.active?this.head=this._getHead():(this.activate(),this.active=!0),this.updateDirtiness(!1),this}isDirty(){return!!this.dirty.value}hasHead(){return!!this.getHead()}destroy(){this.head=null,this.subscription&&this.subscription.unsubscribe(),this._reset&&this._reset.complete()}isPathDirty(t){const e=this.getHead(),n=Ot(this.getQuery().getValue(),t),o=Ot(e,t);return this.params.comparator(n,o)}getHead(){return this.head}activate(){this.head=this._getHead();const t=this.params.watchProperty?this.params.watchProperty.map(e=>this.query.select(i=>i[e]).pipe((0,d.map)(i=>({val:i,__akitaKey:e})))):[this.selectSource(this._entityId)];this.subscription=(0,d.combineLatest)(t).pipe((0,d.skip)(1)).subscribe(e=>{if(J(this.head))return;const i=e.some(n=>this.params.comparator(n.__akitaKey?this.head[n.__akitaKey]:this.head,n.__akitaKey?n.val:n));this.updateDirtiness(i)})}updateDirtiness(t){this.dirty.next(t)}_getHead(){let t=this.getSource(this._entityId);return this.params.watchProperty&&(t=this.getWatchedValues(t)),t}getWatchedValues(t){return this.params.watchProperty.reduce((e,i)=>(e[i]=t[i],e),{})}}class oe{constructor(t,e){this.query=t,this.entityIds=e,this.entities=new Map}getEntity(t){return this.entities.get(t)}hasEntity(t){return this.entities.has(t)}removeEntity(t){return this.destroy(t),this.entities.delete(t)}createEntity(t,e){return this.entities.set(t,e)}getIds(){return J(this.entityIds)?this.query.getValue().ids:I(this.entityIds)}resolvedIds(t){return J(t)?this.getIds():I(t)}rebase(t,e={}){if(ut(t))if(J(this.entityIds)){for(let i=0,n=t.length;i<n;i++){const o=t[i];if(!1===this.hasEntity(o)){S(e.beforeAdd)&&e.beforeAdd(o);const h=this.instantiatePlugin(o);this.entities.set(o,h),S(e.afterAdd)&&e.afterAdd(h)}}this.entities.forEach((i,n)=>{-1===t.indexOf(n)&&(S(e.beforeRemove)&&e.beforeRemove(i),this.removeEntity(n))})}else{const i=I(this.entityIds);for(let n=0,o=i.length;n<o;n++){const h=i[n];if(t.indexOf(h)>-1&&!1===this.hasEntity(h)){S(e.beforeAdd)&&e.beforeAdd(h);const y=this.instantiatePlugin(h);this.entities.set(h,y),S(e.afterAdd)&&e.afterAdd(y)}else this.entities.forEach((y,g)=>{-1===t.indexOf(g)&&!0===this.hasEntity(g)&&(S(e.beforeRemove)&&e.beforeRemove(y),this.removeEntity(g))})}}else this.getIds().forEach(i=>{this.hasEntity(i)||this.createEntity(i,this.instantiatePlugin(i))})}selectIds(){return this.query.select(t=>t.ids)}activate(t){this.rebase(t)}forEachId(t,e){const i=this.resolvedIds(t);for(let n=0,o=i.length;n<o;n++){const h=i[n];this.hasEntity(h)&&e(this.getEntity(h))}}}class di extends oe{constructor(t,e={}){super(t,e.entityIds),this.query=t,this.params=e,this._someDirty=new d.Subject,this.someDirty$=(0,d.merge)(this.query.select(i=>i.entities),this._someDirty.asObservable()).pipe((0,d.auditTime)(0),(0,d.map)(()=>this.checkSomeDirty())),this.params={...ae,...e},this.activate(),this.selectIds().pipe((0,d.skip)(1)).subscribe(i=>{super.rebase(i,{afterAdd:n=>n.setHead()})})}setHead(t){if(this.params.entityIds&&t){const e=I(t);if(!1===I(this.params.entityIds).some(n=>e.indexOf(n)>-1))return this}return this.forEachId(t,e=>e.setHead()),this._someDirty.next(!0),this}hasHead(t){return!!this.entities.has(t)&&this.getEntity(t).hasHead()}reset(t,e={}){this.forEachId(t,i=>i.reset(e))}isDirty(t,e=!0){if(this.entities.has(t)){const i=this.getEntity(t);return e?i.isDirty$:i.isDirty()}return!1}someDirty(){return this.checkSomeDirty()}isPathDirty(t,e){if(this.entities.has(t)){const i=this.getEntity(t).getHead(),o=Ot(this.query.getEntity(t),e),h=Ot(i,e);return this.params.comparator(o,h)}return null}destroy(t){this.forEachId(t,e=>e.destroy()),t||this._someDirty.complete()}instantiatePlugin(t){return new $e(this.query,this.params,t)}checkSomeDirty(){const t=this.resolvedIds();for(const e of t)if(this.getEntity(e).isDirty())return!0;return!1}}const yi={pagesControls:!1,range:!1,startWith:1,cacheTimeout:void 0,clearStoreWithCache:!0};class ue extends xt{constructor(t,e={}){super(t,{resetFn:()=>{this.initial=!1,this.destroy({clearCache:!0,currentPage:1})}}),this.query=t,this.config=e,this.metadata=new Map,this.pages=new Map,this.pagination={currentPage:1,perPage:0,total:0,lastPage:0,data:[]},this.initial=!0,this.isLoading$=this.query.selectLoading().pipe((0,d.delay)(0)),this.config={...yi,...e};const{startWith:i,cacheTimeout:n}=this.config;this.page=new d.BehaviorSubject(i),(0,d.isObservable)(n)&&(this.clearCacheSubscription=n.subscribe(()=>this.clearCache()))}get pageChanges(){return this.page.asObservable()}get currentPage(){return this.pagination.currentPage}get isFirst(){return 1===this.currentPage}get isLast(){return this.currentPage===this.pagination.lastPage}withControls(){return this.config.pagesControls=!0,this}withRange(){return this.config.range=!0,this}setLoading(t=!0){this.getStore().setLoading(t)}update(t){this.pagination=t,this.addPage(t.data)}addPage(t){this.pages.set(this.currentPage,{ids:t.map(e=>e[this.getStore().idKey])}),this.getStore().upsertMany(t)}clearCache(t={}){this.initial||(H("@Pagination - Clear Cache"),!1!==t.clearStore&&(this.config.clearStoreWithCache||t.clearStore)&&this.getStore().remove(),this.pages=new Map,this.metadata=new Map),this.initial=!1}clearPage(t){this.pages.delete(t)}destroy({clearCache:t,currentPage:e}={}){this.clearCacheSubscription&&this.clearCacheSubscription.unsubscribe(),t&&this.clearCache(),J(e)||this.setPage(e),this.initial=!0}isPageActive(t){return this.currentPage===t}setPage(t){(t!==this.currentPage||!this.hasPage(t))&&this.page.next(this.pagination.currentPage=t)}nextPage(){this.currentPage!==this.pagination.lastPage&&this.setPage(this.pagination.currentPage+1)}prevPage(){this.pagination.currentPage>1&&this.setPage(this.pagination.currentPage-1)}setLastPage(){this.setPage(this.pagination.lastPage)}setFirstPage(){this.setPage(1)}hasPage(t){return this.pages.has(t)}getPage(t){let e=this.pagination.currentPage;return this.hasPage(e)?this.selectPage(e):(this.setLoading(!0),(0,d.from)(t()).pipe((0,d.switchMap)(i=>(e=i.currentPage,Tt(()=>{this.setLoading(!1),this.update(i)}),this.selectPage(e)))))}getQuery(){return this.query}refreshCurrentPage(){!1===R(this.currentPage)&&(this.clearPage(this.currentPage),this.setPage(this.currentPage))}getFrom(){return this.isFirst?1:(this.currentPage-1)*this.pagination.perPage+1}getTo(){return this.isLast?this.pagination.total:this.currentPage*this.pagination.perPage}selectPage(t){return this.query.selectAll({asObject:!0}).pipe((0,d.take)(1),(0,d.map)(e=>{const i={...this.pagination,data:this.pages.get(t).ids.map(h=>e[h])},{range:n,pagesControls:o}=this.config;return isNaN(this.pagination.total)&&(i.total=1===i.lastPage?i.data?i.data.length:0:i.perPage*i.lastPage,this.pagination.total=i.total),n&&(i.from=this.getFrom(),i.to=this.getTo()),o&&(i.pageControls=function pi(s,t){const e=Math.ceil(s/t),i=[];for(let n=0;n<e;n++)i.push(n+1);return i}(this.pagination.total,this.pagination.perPage)),i}))}}(0,q.Cg)([$t("@Pagination - New Page"),(0,q.Sn)("design:type",Function),(0,q.Sn)("design:paramtypes",[Object]),(0,q.Sn)("design:returntype",void 0)],ue.prototype,"update",null);const gi=ue;class bi extends xt{constructor(t,e,i={}){super(t),this.query=t,this.factoryFnOrPath=e,this.params=i,this.params={debounceTime:300,formKey:"akitaForm",emitEvent:!1,arrControlFactory:n=>this.builder.control(n),...i},this.isRootKeys=!1===ut(e),this.isKeyBased=Ct(e)||this.isRootKeys}setForm(t,e){return this.form=t,this.builder=e,this.activate(),this}reset(t){let e;e=t||(this.isKeyBased?this.initialValue:this.factoryFnOrPath()),this.isKeyBased&&Object.keys(this.initialValue).forEach(n=>{const o=this.initialValue[n];Array.isArray(o)&&this.builder&&(this.cleanArray(this.form.controls[n]),o.forEach((y,g)=>{this.form.get(n).insert(g,this.params.arrControlFactory(y))}))}),this.form.patchValue(e,{emitEvent:this.params.emitEvent});const i=this.isKeyBased?jt(this.getQuery().getValue(),`${this.getStore().storeName}.${this.factoryFnOrPath}`,e):{[this.params.formKey]:e};this.updateStore(i)}cleanArray(t){for(;0!==t.length;)t.removeAt(0)}resolveInitialValue(t,e){if(t)return Object.keys(t).reduce((i,n)=>{const o=e[n];if(Array.isArray(o)&&this.builder){const h=this.params.arrControlFactory;this.cleanArray(this.form.get(n)),o.forEach((y,g)=>{this.form.get(n).insert(g,h(y))})}return i[n]=e[n],i},{})}activate(){let t;if(this.isKeyBased)if(this.isRootKeys)this.initialValue=this.resolveInitialValue(this.form.value,this.getQuery().getValue()),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent});else{t=`${this.getStore().storeName}.${this.factoryFnOrPath}`;const e=Ut(this.getQuery().getValue(),t);this.initialValue=this.resolveInitialValue(e,e),this.form.patchValue(this.initialValue,{emitEvent:this.params.emitEvent})}else{this.getQuery().getValue()[this.params.formKey]||(H("@PersistNgFormPlugin activate"),this.updateStore({[this.params.formKey]:this.factoryFnOrPath()}));const e=this.getQuery().getValue()[this.params.formKey];this.form.patchValue(e)}this.formChanges=this.form.valueChanges.pipe((0,d.debounceTime)(this.params.debounceTime)).subscribe(e=>{let i;H("@PersistForm - Update"),i=this.isKeyBased?this.isRootKeys?n=>({...n,...e}):n=>jt(n,t,e):()=>({[this.params.formKey]:e}),this.updateStore(i(this.getQuery().getValue()))})}destroy(){this.formChanges&&this.formChanges.unsubscribe(),this.form=null,this.builder=null}}class Ne extends xt{constructor(t,e={},i){super(t,{resetFn:()=>this.clear()}),this.query=t,this.params=e,this._entityId=i,this.skip=!1,this.history={past:[],present:null,future:[]},this.skipUpdate=!1,e.maxAge=e.maxAge?e.maxAge:10,e.comparator=e.comparator||(()=>!0),this.activate()}get hasPast$(){return this._hasPast$}get hasFuture$(){return this._hasFuture$}get hasPast(){return this.history.past.length>0}get hasFuture(){return this.history.future.length>0}get property(){return this.params.watchProperty}updateHasHistory(){this.hasFutureSubject.next(this.hasFuture),this.hasPastSubject.next(this.hasPast)}activate(){this.hasPastSubject=new d.BehaviorSubject(!1),this._hasPast$=this.hasPastSubject.asObservable().pipe((0,d.distinctUntilChanged)()),this.hasFutureSubject=new d.BehaviorSubject(!1),this._hasFuture$=this.hasFutureSubject.asObservable().pipe((0,d.distinctUntilChanged)()),this.history.present=this.getSource(this._entityId,this.property),this.subscription=this.selectSource(this._entityId,this.property).pipe((0,d.pairwise)()).subscribe(([t,e])=>{if(this.skip)return void(this.skip=!1);const i=this.params.comparator(t,e);!this.skipUpdate&&i&&(this.history.past.length===this.params.maxAge&&(this.history.past=this.history.past.slice(1)),this.history.past=[...this.history.past,t],this.history.present=e,this.updateHasHistory())})}undo(){if(this.history.past.length>0){const{past:t,present:e}=this.history,i=t[t.length-1];this.history.past=t.slice(0,t.length-1),this.history.present=i,this.history.future=[e,...this.history.future],this.update()}}redo(){if(this.history.future.length>0){const{past:t,present:e}=this.history,i=this.history.future[0],n=this.history.future.slice(1);this.history.past=[...t,e],this.history.present=i,this.history.future=n,this.update("Redo")}}jumpToPast(t){if(t<0||t>=this.history.past.length)return;const{past:e,future:i,present:n}=this.history,o=e.slice(0,t),h=[...e.slice(t+1),n,...i],y=e[t];this.history.past=o,this.history.present=y,this.history.future=h,this.update()}jumpToFuture(t){if(t<0||t>=this.history.future.length)return;const{past:e,future:i,present:n}=this.history,o=[...e,n,...i.slice(0,t)],h=i[t],y=i.slice(t+1);this.history.past=o,this.history.present=h,this.history.future=y,this.update("Redo")}jump(t){return t>0?this.jumpToFuture(t-1):t<0?this.jumpToPast(this.history.past.length+t):void 0}clear(t){this.history=S(t)?t(this.history):{past:[],present:null,future:[]},this.updateHasHistory()}destroy(t=!1){t&&this.clear(),this.subscription.unsubscribe()}ignoreNext(){this.skip=!0}update(t="Undo"){this.skipUpdate=!0,H(`@StateHistory - ${t}`),this.updateStore(this.history.present,this._entityId,this.property,!0),this.updateHasHistory(),this.skipUpdate=!1}}class mi extends oe{constructor(t,e={}){super(t,e.entityIds),this.query=t,this.params=e,e.maxAge=ut(e.maxAge)?e.maxAge:10,this.activate(),this.selectIds().pipe((0,d.skip)(1)).subscribe(i=>this.activate(i))}redo(t){this.forEachId(t,e=>e.redo())}undo(t){this.forEachId(t,e=>e.undo())}hasPast(t){if(this.hasEntity(t))return this.getEntity(t).hasPast}hasFuture(t){if(this.hasEntity(t))return this.getEntity(t).hasFuture}jumpToFuture(t,e){this.forEachId(t,i=>i.jumpToFuture(e))}jumpToPast(t,e){this.forEachId(t,i=>i.jumpToPast(e))}clear(t,e){this.forEachId(t,i=>i.clear(e))}destroy(t,e=!1){this.forEachId(t,i=>i.destroy(e))}ignoreNext(t){this.forEachId(t,e=>e.ignoreNext())}instantiatePlugin(t){return new Ne(this.query,this.params,t)}}function Si(s){s=Object.assign({},{exclude:[]},s);const e=Object.keys(C);Tt(()=>{for(const i of e){const n=C[i];s.exclude?-1===s.exclude.indexOf(n.storeName)&&n.reset():n.reset()}})}var ce=function(s){return s.Update="UPDATE",s}(ce||{});const Ei={[ce.Update]:"update"};var st=function(s){return s.Update="UPDATE",s.AddEntities="ADD_ENTITIES",s.SetEntities="SET_ENTITIES",s.UpdateEntities="UPDATE_ENTITIES",s.RemoveEntities="REMOVE_ENTITIES",s.UpsertEntities="UPSERT_ENTITIES",s.UpsertManyEntities="UPSERT_MANY_ENTITIES",s}(st||{});const _i={[st.Update]:"update",[st.AddEntities]:"add",[st.SetEntities]:"set",[st.UpdateEntities]:"update",[st.RemoveEntities]:"remove",[st.UpsertEntities]:"upsert",[st.UpsertManyEntities]:"upsertMany"};function he(s){return qt(s[pt].storeName)}function qt(s){const t=C[s];if(R(t))throw new ze(`${t.storeName} doesn't exist`);return t}function Be(s){return he(s)}function Me(s){return qt(s)}function vi(s,t,e){const i="string"==typeof s?qt(s):he(s);e(i[Ei[t]].bind(i))}function wi(s,t,e){const i="string"==typeof s?Me(s):Be(s);e(i[_i[t]].bind(i))}function Pi(s){return function(t){return(0,d.defer)(()=>(s.setLoading(!0),t.pipe((0,d.finalize)(()=>s.setLoading(!1)))))}}function Ai(s){return function(t){return(0,d.defer)(()=>(s.setLoading(!0),s.setError(null),t.pipe((0,d.tap)({error(e){s.setLoading(!1),s.setError(e)},complete(){s.setLoading(!1)}}))))}}class Re{getStoresSnapshot(t=[]){const e={},n=t.length>0?t:Object.keys(C);for(let o=0;o<n.length;o++){const h=n[o];"router"!==h&&(e[h]=C[h]._value())}return e}setStoresSnapshot(t,e){const i={skipStorageUpdate:!1,lazy:!1,...e};i.skipStorageUpdate&&Ve(!0);let n=t;Ct(t)&&(n=JSON.parse(n));const o=Object.keys(n).length;if(i.lazy)u.pipe((0,d.filter)(h=>n.hasOwnProperty(h)),(0,d.take)(o)).subscribe(h=>C[h]._setState(()=>n[h]));else for(let h=0,y=Object.keys(n);h<y.length;h++){const g=y[h];C[g]&&C[g]._setState(()=>n[g])}i.skipStorageUpdate&&Ve(!1)}}const Ii=new Re;function Ti(s,t=et){const e=[];for(const i of s)e.push(i[t]);return e}function Ci(s){return t=>t.lift(new Ui(s))}class Ui{constructor(t){this.query=t}call(t,e){return e.pipe((0,d.first)(),(0,d.switchMap)(i=>{let n=i[this.query.__store__.config.idKey],o=!1;return(0,d.merge)((0,d.of)({newId:void 0,oldId:n,pending:!1}),this.query.__store__.selectEntityIdChanges$).pipe((0,d.filter)(h=>h.oldId===n),(0,d.tap)(h=>o=h.pending),(0,d.filter)(h=>h.newId!==n&&!o),(0,d.switchMap)(h=>this.query.selectEntity(n=h.newId||n).pipe((0,d.filter)(()=>!o))))})).subscribe(t)}}},1635:(Le,Dt,ct)=>{function D(r,a,c,u){var b,l=arguments.length,f=l<3?a:null===u?u=Object.getOwnPropertyDescriptor(a,c):u;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(r,a,c,u);else for(var P=r.length-1;P>=0;P--)(b=r[P])&&(f=(l<3?b(f):l>3?b(a,c,f):b(a,c))||f);return l>3&&f&&Object.defineProperty(a,c,f),f}function lt(r,a){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(r,a)}function ft(r,a,c,u){return new(c||(c=Promise))(function(f,b){function P(x){try{m(u.next(x))}catch($){b($)}}function V(x){try{m(u.throw(x))}catch($){b($)}}function m(x){x.done?f(x.value):function l(f){return f instanceof c?f:new c(function(b){b(f)})}(x.value).then(P,V)}m((u=u.apply(r,a||[])).next())})}function S(r){return this instanceof S?(this.v=r,this):new S(r)}function wt(r,a,c){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,u=c.apply(r,a||[]),f=[];return l=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),P("next"),P("throw"),P("return",function b(U){return function(M){return Promise.resolve(M).then(U,$)}}),l[Symbol.asyncIterator]=function(){return this},l;function P(U,M){u[U]&&(l[U]=function(N){return new Promise(function(W,Q){f.push([U,N,W,Q])>1||V(U,N)})},M&&(l[U]=M(l[U])))}function V(U,M){try{!function m(U){U.value instanceof S?Promise.resolve(U.value.v).then(x,$):C(f[0][2],U)}(u[U](M))}catch(N){C(f[0][3],N)}}function x(U){V("next",U)}function $(U){V("throw",U)}function C(U,M){U(M),f.shift(),f.length&&V(f[0][0],f[0][1])}}function Bt(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,a=r[Symbol.asyncIterator];return a?a.call(r):(r=function I(r){var a="function"==typeof Symbol&&Symbol.iterator,c=a&&r[a],u=0;if(c)return c.call(r);if(r&&"number"==typeof r.length)return{next:function(){return r&&u>=r.length&&(r=void 0),{value:r&&r[u++],done:!r}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),c={},u("next"),u("throw"),u("return"),c[Symbol.asyncIterator]=function(){return this},c);function u(f){c[f]=r[f]&&function(b){return new Promise(function(P,V){!function l(f,b,P,V){Promise.resolve(V).then(function(m){f({value:m,done:P})},b)}(P,V,(b=r[f](b)).done,b.value)})}}}ct.d(Dt,{AQ:()=>wt,Cg:()=>D,N3:()=>S,Sn:()=>lt,sH:()=>ft,xN:()=>Bt}),"function"==typeof SuppressedError&&SuppressedError}}]);